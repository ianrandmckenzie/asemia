(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function i(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=i(o);fetch(o.href,r)}})();let a=null,c=null,_="bodies",V=!1;const C={positioning:{joins:{"2x1":{"67_5_deg":{top:{vertical:"bottom: -14%",horizontal:{right:"right: -5%",left:"left: -5%"}},bottom:{vertical:"top: -14%",horizontal:{right:"right: -5%",left:"left: -5%"}}},"112_5_deg":{top:{vertical:"bottom: -15%",horizontal:{right:"left: -27%",left:"right: -27%"}},bottom:{vertical:"top: -15%",horizontal:{right:"left: -27%",left:"right: -27%"}}},"135_deg":{top:{vertical:"bottom: -15%",horizontal:{right:"left: -15%",left:"right: -15%"}},bottom:{vertical:"top: -15%",horizontal:{right:"left: -15%",left:"right: -15%"}}},default:{top:{vertical:"bottom: 5%",horizontal:{right:"left: -17%",left:"right: -17%"}},bottom:{vertical:"top: 5%",horizontal:{right:"left: -17%",left:"right: -17%"}}}},"1x2":{"67_5_deg":{top:{vertical:"top: -5%",horizontal:{left:"right: 27%",right:"left: 27%"}},bottom:{vertical:"bottom: -5%",horizontal:{left:"right: 27%",right:"left: 27%"}}},"112_5_deg":{top:{vertical:"top: 27%",horizontal:{left:"left: -5%",right:"right: -5%"}},bottom:{vertical:"bottom: 27%",horizontal:{left:"left: -5%",right:"right: -5%"}}},"135_deg":{top:{vertical:"bottom: -15%",horizontal:{left:"right: -15%",right:"left: -15%"}},bottom:{vertical:"top: -15%",horizontal:{left:"right: -15%",right:"left: -15%"}}},default:{top:{vertical:"bottom: -17%",horizontal:{left:"right: 5%",right:"left: 5%"}},bottom:{vertical:"top: -17%",horizontal:{left:"right: 5%",right:"left: 5%"}}}},"1x1":{"45_deg":{top:{vertical:"top: -5%",horizontal:{left:"left: -5%",right:"right: -5%"}},bottom:{vertical:"bottom: -5%",horizontal:{left:"left: -5%",right:"right: -5%"}}},"90_deg":{top:{vertical:"top: -5%",horizontal:{left:"left: -5%",right:"right: -5%"}},bottom:{vertical:"bottom: -5%",horizontal:{left:"left: -5%",right:"right: -5%"}}}}},serifs:{"22_5_deg":{br_to_tl:{type:"special",right:"-7%",vertical:{top:{top:"0"},bottom:{bottom:"0"},center:{top:"50%",transform:"translateY(-50%)"}}},tr_to_bl:{type:"special",right:"-7%",vertical:{top:{top:"0"},bottom:{bottom:"0"},center:{top:"50%",transform:"translateY(-50%)"}}},bl_to_tr:{type:"special",left:"-7%",vertical:{top:{top:"0"},bottom:{bottom:"0"},center:{top:"50%",transform:"translateY(-50%)"}}},tl_to_br:{type:"special",left:"-7%",vertical:{top:{top:"0"},bottom:{bottom:"0"},center:{top:"50%",transform:"translateY(-50%)"}}},side:{type:"side",bottom:{top:"-7%",right:"0",maxHeight:"200%"},top:{bottom:"-7%",left:"0",maxHeight:"200%"},default:{top:"0"},horizontal:{left:{left:"0"},right:{right:"0"},center:{left:"50%",transform:"translateX(-50%)"}}},regular:{type:"regular",horizontal:{right:{left:"-25%",maxWidth:"200%"},left:{right:"-25%",maxWidth:"200%"},default:{left:"0"}},vertical:{top:{top:"0"},bottom:{bottom:"0"},center:{top:"50%",transform:"translateY(-50%)"}}}},"45_deg":{tl_to_br:{right:"0%",top:"0%"},bl_to_tr:{right:"0%",bottom:"0%"},tr_to_bl:{left:"0%",top:"0%"},br_to_tl:{left:"0%",bottom:"0%"},side_tl_to_br:{right:"0%",bottom:"0%"},side_bl_to_tr:{right:"0%",top:"0%"},side_tr_to_bl:{left:"0%",bottom:"0%"},side_br_to_tl:{left:"0%",top:"0%"}}},bodies:{"2x1":{type:"topLeft"},"1x2":{type:"topLeft"},"1x1":{type:"standard"}},standard:{vertical:{top:{top:"0",transform:{center:"translateX(-50%)",default:""}},center:{top:"50%",transform:{center:"translate(-50%, -50%)",default:"translateY(-50%)"}},bottom:{bottom:"0",transform:{center:"translateX(-50%)",default:""}}},horizontal:{left:{left:"0"},center:{left:"50%"},right:{right:"0"}}}}};async function E(){await H(),R(),q(),Q(),Z(),D(),j(),window.getCellPosition=k,window.getCellByPosition=x,window.getOccupiedCells=L,window.clearCellHighlights=z,window.placeShapeInCell=O,window.applyPositioning=T,window.rulesData=a,window.shapeConfig=C,window.getSelectedShape=()=>c,window.handleGridCellClick=I,window.handleGridCellRightClick=P,window.handleGridCellLeave=B,console.log("Builder functions made globally accessible")}async function $(){await H(),window.getCellPosition=k,window.getCellByPosition=x,window.getOccupiedCells=L,window.clearCellHighlights=z,window.placeShapeInCell=O,window.applyPositioning=T,window.rulesData=a,window.shapeConfig=C,console.log("Builder core functions initialized")}async function H(){try{a=await(await fetch("./assets/rules.json")).json()}catch(t){console.error("Failed to load rules.json:",t)}}function R(){A(),Y()}function A(){const t=document.getElementById("serifsGrid");if(t){t.innerHTML="";for(let e=0;e<25;e++){const i=document.createElement("div");i.className="w-[100px] h-[100px] relative cursor-pointer grid-cell",i.dataset.grid="serifs",i.dataset.index=e,i.addEventListener("click",I),i.addEventListener("contextmenu",P),i.addEventListener("mouseenter",M),i.addEventListener("mouseleave",B),t.appendChild(i)}}}function Y(){const t=document.getElementById("joinsGrid");if(t){t.innerHTML="";for(let e=0;e<16;e++){const i=document.createElement("div");i.className="w-[100px] h-[100px] relative cursor-pointer grid-cell",i.dataset.grid="joins",i.dataset.index=e,i.addEventListener("click",I),i.addEventListener("contextmenu",P),i.addEventListener("mouseenter",M),i.addEventListener("mouseleave",B),t.appendChild(i)}}}function q(){X(),J(),F()}function X(){var e;const t=document.getElementById("bodiesShapes");if(t){if(t.innerHTML="",!((e=a==null?void 0:a.shapes)!=null&&e.bodies))return;Object.keys(a.shapes.bodies).forEach(i=>{if(i==="grid")return;a.shapes.bodies[i].forEach(o=>{const r=G("bodies",i,o);t.appendChild(r)})})}}function J(){var e;const t=document.getElementById("serifsShapes");if(t){if(t.innerHTML="",!((e=a==null?void 0:a.shapes)!=null&&e.serifs))return;Object.keys(a.shapes.serifs).forEach(i=>{if(i==="grid")return;a.shapes.serifs[i].forEach(o=>{const r=G("serifs",i,o);t.appendChild(r)})})}}function F(){var e;const t=document.getElementById("joinsShapes");if(t){if(t.innerHTML="",!((e=a==null?void 0:a.shapes)!=null&&e.joins))return;Object.keys(a.shapes.joins).forEach(i=>{if(i==="grid")return;a.shapes.joins[i].forEach(o=>{const r=G("joins",i,o);t.appendChild(r)})})}}function G(t,e,i){const n=document.createElement("button");n.className="w-12 h-12 border border-gray-300 dark:border-gray-700 rounded hover:border-blue-500 dark:hover:border-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/40 flex items-center justify-center relative shape-button";let o=null;return window.SVGUtils&&window.SVGUtils.createSVGElement&&(o=window.SVGUtils.createSVGElement(t,e,i.shape_name,"w-8 h-8 object-contain")),o?(o.setAttribute("alt",i.shape_name),n.appendChild(o)):(n.textContent=i.shape_name.substring(0,2),n.className+=" text-xs font-mono",console.warn(`Could not create SVG for ${t}/${e}/${i.shape_name}, using text fallback`)),n.dataset.category=t,n.dataset.angleKey=e,n.dataset.shapeName=i.shape_name,n.dataset.cellOrientation=i.cell_orientation,n.addEventListener("click",()=>W(n,t,e,i)),n}function W(t,e,i,n){document.querySelectorAll(".shape-selected").forEach(o=>{o.classList.remove("shape-selected","bg-blue-200","border-blue-500","dark:bg-blue-800/40","dark:border-blue-400")}),t.classList.add("shape-selected","bg-blue-200","border-blue-500","dark:bg-blue-800/40","dark:border-blue-400"),c={category:e,angleKey:i,shape:n,imagePath:`./assets/shapes/${e}/${i}/${n.shape_name}.svg`},U()}function k(t,e){if(e==="serifs"){const i=Math.floor(t/5),n=t%5;return{row:i,col:n,gridSize:5}}else if(e==="joins"){const i=Math.floor(t/4),n=t%4;return{row:i,col:n,gridSize:4}}}function x(t,e,i){const n=i==="serifs"?5:4;if(t<0||e<0||t>=n||e>=n)return null;const o=t*n+e;return document.getElementById(i+"Grid").children[o]}function L(t,e){const i=t.dataset.grid,n=parseInt(t.dataset.index),o=k(n,i),r=e.shape.width||1,s=e.shape.height||1,l=[];if(r===2&&s===1){l.push(t);const f=x(o.row,o.col+1,i);f&&l.push(f)}else if(r===1&&s===2){l.push(t);const f=x(o.row+1,o.col,i);f&&l.push(f)}else l.push(t);return l}function M(t){if(!c)return;const e=t.currentTarget,i=e.dataset.grid,n=a.shapes[c.category].grid;if(i!==n)return;z(),L(e,c).forEach(r=>{r&&r.classList.add("cell-highlight")})}function B(t){z()}function z(){document.querySelectorAll(".cell-highlight, .cell-highlight-valid, .cell-highlight-invalid").forEach(t=>{t.classList.remove("cell-highlight","cell-highlight-valid","cell-highlight-invalid")})}function I(t){if(!c){alert("Please select a shape from the sidebar first");return}const e=t.currentTarget,i=e.dataset.grid,n=a.shapes[c.category].grid;if(i!==n){alert(`This shape can only be placed on the ${n} grid`);return}const o=L(e,c);if(o.some(l=>!l)){alert("Shape extends beyond grid boundaries");return}if(typeof validateShapeConnections=="function"&&!validateShapeConnections(e,c)){console.log("Placement blocked by constraints");return}const s=typeof validateShapeConnections=="function"||c.category!=="bodies"&&c.category!=="joins"||c.shape.width>1||c.shape.height>1;s&&o.forEach(l=>{l&&(l.innerHTML="")}),O(e,c,!s)}function K(t,e){const{angleKey:i,shape:n}=e,o=n.width||1,r=n.height||1,s=n.cell_orientation,l=`${o}x${r}`,f=C.positioning.joins[l];if(!f)return;const b=f[i]||f.default,u=s.includes("top")?"top":"bottom",g=b[u],p=g.vertical.split(": ");t.style[p[0]]=p[1];const h=s.includes("right")?"right":"left",m=g.horizontal[h].split(": ");t.style[m[0]]=m[1],t.style.transform=""}function T(t,e){const{category:i,angleKey:n,shape:o}=e,r=o.width||1,s=o.height||1,l=o.cell_orientation.split(" "),f=l[0],b=l[1];if(t.style.transform="",i==="joins"&&(r===2||s===2))return K(t,e);if(i==="joins"&&r===1&&s===1){const g=C.positioning.joins["1x1"][n];if(g){const p=l.includes("top")?"top":"bottom",h=g[p];if(h){const m=h.vertical.split(": ");t.style[m[0]]=m[1];const S=l.includes("right")?"right":"left",d=h.horizontal[S].split(": ");t.style[d[0]]=d[1],t.style.transform="";return}}t.style.top="-5%",t.style.left="-5%",t.style.transform="";return}if(i==="bodies"&&(r===2||s===2)){t.style.top="0",t.style.left="0",t.style.transform="";return}if(i==="serifs"){const u=C.positioning.serifs[n];if(!u)return N(t,f,b);if(n==="22_5_deg"){const g=o.shape_name;if(u[g]){const d=u[g];d.left&&(t.style.left=d.left),d.right&&(t.style.right=d.right);const y=d.vertical[f];y&&Object.keys(y).forEach(v=>{t.style[v]=y[v]});return}if(o.cell_orientation.includes("top")||o.cell_orientation.includes("bottom")){const d=u.side,y=d[f]||d.default;Object.keys(y).forEach(w=>{w!=="transform"&&(t.style[w]=y[w])});const v=d.horizontal[b];v&&Object.keys(v).forEach(w=>{t.style[w]=v[w]});return}const h=u.regular,m=h.horizontal[b]||h.horizontal.default,S=h.vertical[f];Object.keys(m).forEach(d=>{t.style[d]=m[d]}),S&&Object.keys(S).forEach(d=>{t.style[d]=S[d]});return}if(n==="45_deg"){const g=o.shape_name,p=u[g];if(p){Object.keys(p).forEach(h=>{t.style[h]=p[h]});return}}}N(t,f,b)}function N(t,e,i){const n=C.positioning.standard,o=n.vertical[e];o&&Object.keys(o).forEach(s=>{if(s==="transform"){const l=o[s];t.style.transform=l[i]||l.default}else t.style[s]=o[s]});const r=n.horizontal[i];r&&(Object.keys(r).forEach(s=>{t.style[s]=r[s]}),i==="center"&&e!=="center"&&(t.style.transform="translateX(-50%)"))}function O(t,e,i=!1){i||(t.innerHTML="");const n="absolute";let o=null;if(window.SVGUtils&&window.SVGUtils.createSVGElement&&(o=window.SVGUtils.createSVGElement(e.category,e.angleKey,e.shape.shape_name,n)),!o){console.warn("Could not create SVG for shape:",e);const r=document.createElement("div");r.textContent=e.shape.shape_name,r.className=n+" text-xs font-mono text-center text-gray-600 dark:text-gray-300",r.style.display="flex",r.style.alignItems="center",r.style.justifyContent="center",t.appendChild(r);return}o.setAttribute("alt",e.shape.shape_name),T(o,e),t.appendChild(o)}function Q(){const t=document.getElementById("bodiesTab"),e=document.getElementById("joinsTab"),i=document.getElementById("bodiesContent"),n=document.getElementById("joinsContent");t&&(t.addEventListener("click",()=>{_="bodies",t.className="flex-1 py-3 px-4 bg-white dark:bg-slate-800 border-r border-gray-300 dark:border-gray-700 font-medium text-gray-900 dark:text-gray-100",e.className="flex-1 py-3 px-4 bg-gray-200 dark:bg-slate-700 font-medium text-gray-700 dark:text-gray-200",i.classList.remove("hidden"),n.classList.add("hidden"),j()}),e.addEventListener("click",()=>{_="joins",e.className="flex-1 py-3 px-4 bg-white dark:bg-slate-800 border-r border-gray-300 dark:border-gray-700 font-medium text-gray-900 dark:text-gray-100",t.className="flex-1 py-3 px-4 bg-gray-200 dark:bg-slate-700 font-medium text-gray-700 dark:text-gray-200",n.classList.remove("hidden"),i.classList.add("hidden"),j()}))}function P(t){t.preventDefault();const e=t.currentTarget;e.innerHTML=""}function U(){const t=document.getElementById("selectedShapeDisplay"),e=document.getElementById("selectedShapeInfo");c?(t.classList.remove("hidden"),e.textContent=`${c.category} > ${c.angleKey} > ${c.shape.shape_name}`):t.classList.add("hidden")}function Z(){document.getElementById("clearSelection")&&document.getElementById("clearSelection").addEventListener("click",()=>{c=null,document.querySelectorAll(".shape-selected").forEach(e=>{e.classList.remove("shape-selected","bg-blue-200","border-blue-500")}),U()})}function D(){const t=document.getElementById("previewToggle");t&&t.addEventListener("change",e=>{V=e.target.checked,document.body.classList.toggle("preview-mode",V)})}function j(){const t=document.getElementById("serifsGrid"),e=document.getElementById("joinsGrid");t&&(_==="bodies"?(t.style.zIndex="20",e.style.zIndex="10",t.classList.remove("grid-inactive"),t.classList.add("grid-active"),e.classList.remove("grid-active"),e.classList.add("grid-inactive")):_==="joins"&&(e.style.zIndex="20",t.style.zIndex="10",e.classList.remove("grid-inactive"),e.classList.add("grid-active"),t.classList.remove("grid-active"),t.classList.add("grid-inactive")))}document.addEventListener("DOMContentLoaded",()=>{window.SVGUtils&&window.SVGUtils.isReady&&window.SVGUtils.isReady()?E():(document.addEventListener("svgSystemReady",E),setTimeout(()=>{window.SVGUtils&&window.SVGUtils.isReady&&window.SVGUtils.isReady()&&(document.removeEventListener("svgSystemReady",E),E())},100))});window.initBuilderCore=$;
