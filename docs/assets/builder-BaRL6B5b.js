const Y={"7xl":.6,"6xl":.5,"5xl":.4,"4xl":.3,"3xl":.25,"2xl":.2,xl:.167,lg:.15,base:.133,sm:.117,xs:.1};let H="7xl";async function O(){if(!document.getElementById("mobileSerifTab")){console.log("Mobile builder not needed on this page (no shape tabs found)");return}if(!window.rulesData){console.warn("rulesData not available yet, waiting..."),setTimeout(O,50);return}K(),se(),oe(),F(),window.addEventListener("resize",F),z("serifs"),console.log("Mobile builder initialized")}function K(){const e=document.getElementById("mobileSerifTab"),t=document.getElementById("mobileBodiesTab"),s=document.getElementById("mobileJoinsTab");e&&(q("serifs","mobileSerifShapes"),q("bodies","mobileBodiesShapes"),q("joins","mobileJoinsShapes"),e.addEventListener("click",()=>z("serifs")),t.addEventListener("click",()=>z("bodies")),s.addEventListener("click",()=>z("joins")))}function q(e,t){var o;const s=document.getElementById(t);if(!s||!((o=window.rulesData)!=null&&o.shapes))return;s.innerHTML="";const i=window.rulesData.shapes[e];i&&Object.keys(i).forEach(n=>{if(n==="grid")return;i[n].forEach(l=>{const g=ee(e,n,l);s.appendChild(g)})})}function ee(e,t,s){var n;const i=document.createElement("button");i.className="mobile-shape-btn",i.dataset.category=e,i.dataset.angleKey=t,i.dataset.shapeName=s.shape_name;const o=(n=window.SVGUtils)==null?void 0:n.createSVGElement(e,t,s.shape_name,"h-8 w-auto object-contain pointer-events-none");return o?i.appendChild(o):i.textContent=s.shape_name.substring(0,2),i.addEventListener("click",()=>{te(i,e,t,s)}),i}function te(e,t,s,i){document.querySelectorAll(".mobile-shape-btn.selected").forEach(n=>{n.classList.remove("selected")}),document.querySelectorAll(".shape-selected").forEach(n=>{n.classList.remove("shape-selected","bg-blue-200","border-blue-500")}),e.classList.add("selected");const o={category:t,angleKey:s,shape:i,imagePath:`./assets/shapes/${t}/${s}/${i.shape_name}.svg`};window.setSelectedShape&&window.setSelectedShape(o),window.updateSelectedShapeDisplay&&window.updateSelectedShapeDisplay()}let V=null;function z(e){const t={serifs:document.getElementById("mobileSerifTab"),bodies:document.getElementById("mobileBodiesTab"),joins:document.getElementById("mobileJoinsTab")},s={serifs:document.getElementById("mobileSerifShapes"),bodies:document.getElementById("mobileBodiesShapes"),joins:document.getElementById("mobileJoinsShapes")},i=document.getElementById("mobileShapeSelectorWrapper");if(V===e){i&&i.classList.add("hidden"),Object.keys(t).forEach(o=>{t[o]&&(t[o].className="mobile-tab flex-1 py-3 px-2 bg-gray-200 dark:bg-slate-800 border-r border-gray-300 dark:border-gray-700")}),Object.keys(s).forEach(o=>{s[o]&&s[o].classList.add("hidden")}),V=null;return}Object.keys(s).forEach(o=>{s[o]&&s[o].classList.add("hidden")}),i&&i.classList.remove("hidden"),s[e]&&s[e].classList.remove("hidden"),Object.keys(t).forEach(o=>{t[o]&&(o===e?t[o].className="mobile-tab flex-1 py-3 px-2 bg-white dark:bg-slate-700 border-r border-gray-300 dark:border-gray-700":t[o].className="mobile-tab flex-1 py-3 px-2 bg-gray-200 dark:bg-slate-800 border-r border-gray-300 dark:border-gray-700")}),V=e,window.setCurrentTab&&(e==="bodies"||e==="serifs"?window.setCurrentTab("bodies"):e==="joins"&&window.setCurrentTab("joins")),window.updateGridLayers&&window.updateGridLayers()}function se(){const e=document.getElementById("mobileSaveMenuBtn"),t=document.getElementById("mobileSizeBtn"),s=document.getElementById("mobilePreviewBtn"),i=document.getElementById("mobileSaveMenu"),o=document.getElementById("mobileSizeMenu"),n=document.getElementById("closeSaveMenu"),r=document.getElementById("closeSizeMenu");if(!e)return;e.addEventListener("click",()=>{const d=i.classList.contains("hidden"),a=i.querySelector(".absolute");d?(i.classList.remove("hidden"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{a.classList.remove("translate-y-full"),a.classList.add("translate-y-0")})})):(i.classList.add("opacity-0"),a.classList.remove("translate-y-0"),a.classList.add("translate-y-full"),setTimeout(()=>{i.classList.add("hidden"),i.classList.remove("opacity-0")},200))}),n.addEventListener("click",()=>{const d=i.querySelector(".absolute");i.classList.add("opacity-0"),d.classList.remove("translate-y-0"),d.classList.add("translate-y-full"),setTimeout(()=>{i.classList.add("hidden"),i.classList.remove("opacity-0")},150)}),i.addEventListener("click",d=>{if(d.target===i){const a=i.querySelector(".absolute");i.classList.add("opacity-0"),a.classList.remove("translate-y-0"),a.classList.add("translate-y-full"),setTimeout(()=>{i.classList.add("hidden"),i.classList.remove("opacity-0")},150)}}),t.addEventListener("click",()=>{const d=o.classList.contains("hidden"),a=o.querySelector(".absolute");d?(o.classList.remove("hidden"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{a.classList.remove("translate-y-full"),a.classList.add("translate-y-0")})})):(o.classList.add("opacity-0"),a.classList.remove("translate-y-0"),a.classList.add("translate-y-full"),setTimeout(()=>{o.classList.add("hidden"),o.classList.remove("opacity-0")},200))}),r.addEventListener("click",()=>{const d=o.querySelector(".absolute");o.classList.add("opacity-0"),d.classList.remove("translate-y-0"),d.classList.add("translate-y-full"),setTimeout(()=>{o.classList.add("hidden"),o.classList.remove("opacity-0")},150)}),o.addEventListener("click",d=>{if(d.target===o){const a=o.querySelector(".absolute");o.classList.add("opacity-0"),a.classList.remove("translate-y-0"),a.classList.add("translate-y-full"),setTimeout(()=>{o.classList.add("hidden"),o.classList.remove("opacity-0")},150)}});let l=!1;s.addEventListener("click",()=>{l=!l,window.setPreviewMode&&window.setPreviewMode(l);const d=s.querySelector("span"),a=document.getElementById("mobilePreviewIcon");l?(s.classList.add("bg-blue-100","dark:bg-blue-900"),d&&(d.classList.remove("text-gray-600","dark:text-gray-300"),d.classList.add("text-blue-700","dark:text-blue-300")),a&&(a.src="/assets/icons/eye-slash.svg")):(s.classList.remove("bg-blue-100","dark:bg-blue-900"),d&&(d.classList.remove("text-blue-700","dark:text-blue-300"),d.classList.add("text-gray-600","dark:text-gray-300")),a&&(a.src="/assets/icons/eye.svg"))});const g=document.getElementById("mobileEraseBtn");g&&ie(g)}let C=!1;function ie(e){e.addEventListener("click",()=>{C=!C,window.clearPendingEraseHighlight&&window.clearPendingEraseHighlight();const t=e.querySelector("span"),s=document.getElementById("mobileEraseIcon");C?(e.classList.add("bg-red-100","dark:bg-red-900"),t&&(t.classList.remove("text-gray-600","dark:text-gray-300"),t.classList.add("text-red-700","dark:text-red-300")),s&&(s.src="/assets/icons/erasing.svg")):(e.classList.remove("bg-red-100","dark:bg-red-900"),t&&(t.classList.remove("text-red-700","dark:text-red-300"),t.classList.add("text-gray-600","dark:text-gray-300")),s&&(s.src="/assets/icons/erase.svg"));const i=document.querySelector(".builder-grids-wrapper");i&&(C?i.style.cursor="crosshair":i.style.cursor="")})}window.isEraseMode=()=>C;window.hideMobileSaveMenu=function(){const e=document.getElementById("mobileSaveMenu"),t=e==null?void 0:e.querySelector(".absolute");e&&t&&(e.classList.add("opacity-0"),t.classList.remove("translate-y-0"),t.classList.add("translate-y-full"),setTimeout(()=>{e.classList.add("hidden"),e.classList.remove("opacity-0")},150))};function oe(){const e=document.getElementById("mobileSizeButtons");if(!e)return;["7xl","6xl","5xl","4xl","3xl","2xl","xl","lg","base","sm","xs"].forEach(s=>{const i=document.createElement("button");i.className=`px-4 py-3 rounded-lg text-sm font-medium transition-colors ${s===H?"bg-blue-500 text-white":"bg-gray-100 dark:bg-slate-700 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-slate-600"}`,i.textContent=s,i.addEventListener("click",()=>{H=s,D(s);const o=document.getElementById("mobileSizeMenu"),n=o.querySelector(".absolute");o.classList.add("opacity-0"),n.classList.remove("translate-y-0"),n.classList.add("translate-y-full"),setTimeout(()=>{o.classList.add("hidden"),o.classList.remove("opacity-0")},150),e.querySelectorAll("button").forEach(r=>{r===i?r.className="px-4 py-3 rounded-lg text-sm font-medium transition-colors bg-blue-500 text-white":r.className="px-4 py-3 rounded-lg text-sm font-medium transition-colors bg-gray-100 dark:bg-slate-700 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-slate-600"})}),e.appendChild(i)})}function D(e){const t=Y[e]||Y["5xl"],s=document.querySelector(".builder-grids-wrapper");s&&(s.style.transform=`scale(${t})`)}function F(){if(window.innerWidth<768)D(H);else{const t=document.querySelector(".builder-grids-wrapper");t&&(t.style.transform="scale(1)")}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{setTimeout(O,100)}):setTimeout(O,100);let f=null,c=null,E="bodies",y=!1,S=!1,B=null;const x={positioning:{joins:{"2x1":{"67_5_deg":{top:{vertical:"bottom: -14%",horizontal:{right:"right: -5%",left:"left: -5%"}},bottom:{vertical:"top: -14%",horizontal:{right:"right: -5%",left:"left: -5%"}}},"112_5_deg":{top:{vertical:"bottom: -15%",horizontal:{right:"left: -27%",left:"right: -27%"}},bottom:{vertical:"top: -15%",horizontal:{right:"left: -27%",left:"right: -27%"}}},"135_deg":{top:{vertical:"bottom: -15%",horizontal:{right:"left: -15%",left:"right: -15%"}},bottom:{vertical:"top: -15%",horizontal:{right:"left: -15%",left:"right: -15%"}}},default:{top:{vertical:"bottom: 5%",horizontal:{right:"left: -17%",left:"right: -17%"}},bottom:{vertical:"top: 5%",horizontal:{right:"left: -17%",left:"right: -17%"}}}},"1x2":{"67_5_deg":{top:{vertical:"top: -5%",horizontal:{left:"right: 27%",right:"left: 27%"}},bottom:{vertical:"bottom: -5%",horizontal:{left:"right: 27%",right:"left: 27%"}}},"112_5_deg":{top:{vertical:"top: 27%",horizontal:{left:"left: -5%",right:"right: -5%"}},bottom:{vertical:"bottom: 27%",horizontal:{left:"left: -5%",right:"right: -5%"}}},"135_deg":{top:{vertical:"bottom: -15%",horizontal:{left:"right: -15%",right:"left: -15%"}},bottom:{vertical:"top: -15%",horizontal:{left:"right: -15%",right:"left: -15%"}}},default:{top:{vertical:"bottom: -17%",horizontal:{left:"right: 5%",right:"left: 5%"}},bottom:{vertical:"top: -17%",horizontal:{left:"right: 5%",right:"left: 5%"}}}},"1x1":{"45_deg":{top:{vertical:"top: -5%",horizontal:{left:"left: -5%",right:"right: -5%"}},bottom:{vertical:"bottom: -5%",horizontal:{left:"left: -5%",right:"right: -5%"}}},"90_deg":{top:{vertical:"top: -5%",horizontal:{left:"left: -5%",right:"right: -5%"}},bottom:{vertical:"bottom: -5%",horizontal:{left:"left: -5%",right:"right: -5%"}}}}},serifs:{"22_5_deg":{br_to_tl:{type:"special",right:"-7%",vertical:{top:{top:"0"},bottom:{bottom:"0"},center:{top:"50%",transform:"translateY(-50%)"}}},tr_to_bl:{type:"special",right:"-7%",vertical:{top:{top:"0"},bottom:{bottom:"0"},center:{top:"50%",transform:"translateY(-50%)"}}},bl_to_tr:{type:"special",left:"-7%",vertical:{top:{top:"0"},bottom:{bottom:"0"},center:{top:"50%",transform:"translateY(-50%)"}}},tl_to_br:{type:"special",left:"-7%",vertical:{top:{top:"0"},bottom:{bottom:"0"},center:{top:"50%",transform:"translateY(-50%)"}}},side:{type:"side",bottom:{top:"-7%",right:"0",maxHeight:"200%"},top:{bottom:"-7%",left:"0",maxHeight:"200%"},default:{top:"0"},horizontal:{left:{left:"0"},right:{right:"0"},center:{left:"50%",transform:"translateX(-50%)"}}},regular:{type:"regular",horizontal:{right:{left:"-25%",maxWidth:"200%"},left:{right:"-25%",maxWidth:"200%"},default:{left:"0"}},vertical:{top:{top:"0"},bottom:{bottom:"0"},center:{top:"50%",transform:"translateY(-50%)"}}}},"45_deg":{tl_to_br:{right:"0%",top:"0%"},bl_to_tr:{right:"0%",bottom:"0%"},tr_to_bl:{left:"0%",top:"0%"},br_to_tl:{left:"0%",bottom:"0%"},side_tl_to_br:{right:"0%",bottom:"0%"},side_bl_to_tr:{right:"0%",top:"0%"},side_tr_to_bl:{left:"0%",bottom:"0%"},side_br_to_tl:{left:"0%",top:"0%"}}},bodies:{"2x1":{type:"topLeft"},"1x2":{type:"topLeft"},"1x1":{type:"standard"}},standard:{vertical:{top:{top:"0",transform:{center:"translateX(-50%)",default:""}},center:{top:"50%",transform:{center:"translate(-50%, -50%)",default:"translateY(-50%)"}},bottom:{bottom:"0",transform:{center:"translateX(-50%)",default:""}}},horizontal:{left:{left:"0"},center:{left:"50%"},right:{right:"0"}}}}};async function T(){await Z(),re(),de(),ye(),ve(),we(),be(),j(),window.getCellPosition=$,window.getCellByPosition=M,window.getOccupiedCells=_,window.clearCellHighlights=G,window.placeShapeInCell=R,window.applyPositioning=P,window.rulesData=f,window.shapeConfig=x,window.getSelectedShape=()=>c,window.setSelectedShape=e=>{c=e},window.handleGridCellClick=A,window.handleGridCellRightClick=W,window.handleGridCellLeave=U,window.clearPendingEraseHighlight=I,window.updateSelectedShapeDisplay=J,window.updateGridLayers=j,window.getCurrentTab=()=>E,window.setCurrentTab=e=>{E=e},window.getPreviewMode=()=>y,window.setPreviewMode=e=>{y=e,document.body.classList.toggle("preview-mode",e)},console.log("Builder functions made globally accessible")}async function ne(){await Z(),window.getCellPosition=$,window.getCellByPosition=M,window.getOccupiedCells=_,window.clearCellHighlights=G,window.placeShapeInCell=R,window.applyPositioning=P,window.rulesData=f,window.shapeConfig=x,console.log("Builder core functions initialized")}async function Z(){try{f=await(await fetch("./assets/rules.json")).json()}catch(e){console.error("Failed to load rules.json:",e)}}function re(){ae(),le()}function ae(){const e=document.getElementById("serifsGrid");if(e){e.innerHTML="";for(let t=0;t<25;t++){const s=document.createElement("div");s.className="w-[100px] h-[100px] relative cursor-pointer grid-cell",s.dataset.grid="serifs",s.dataset.index=t,s.addEventListener("click",A),s.addEventListener("contextmenu",W),s.addEventListener("mouseenter",Q),s.addEventListener("mouseleave",U),e.appendChild(s)}}}function le(){const e=document.getElementById("joinsGrid");if(e){e.innerHTML="";for(let t=0;t<16;t++){const s=document.createElement("div");s.className="w-[100px] h-[100px] relative cursor-pointer grid-cell",s.dataset.grid="joins",s.dataset.index=t,s.addEventListener("click",A),s.addEventListener("contextmenu",W),s.addEventListener("mouseenter",Q),s.addEventListener("mouseleave",U),e.appendChild(s)}}}function de(){ce(),ge(),fe()}function ce(){var t;const e=document.getElementById("bodiesShapes");if(e){if(e.innerHTML="",!((t=f==null?void 0:f.shapes)!=null&&t.bodies))return;Object.keys(f.shapes.bodies).forEach(s=>{if(s==="grid")return;f.shapes.bodies[s].forEach(o=>{const n=N("bodies",s,o);e.appendChild(n)})})}}function ge(){var t;const e=document.getElementById("serifsShapes");if(e){if(e.innerHTML="",!((t=f==null?void 0:f.shapes)!=null&&t.serifs))return;Object.keys(f.shapes.serifs).forEach(s=>{if(s==="grid")return;f.shapes.serifs[s].forEach(o=>{const n=N("serifs",s,o);e.appendChild(n)})})}}function fe(){var t;const e=document.getElementById("joinsShapes");if(e){if(e.innerHTML="",!((t=f==null?void 0:f.shapes)!=null&&t.joins))return;Object.keys(f.shapes.joins).forEach(s=>{if(s==="grid")return;f.shapes.joins[s].forEach(o=>{const n=N("joins",s,o);e.appendChild(n)})})}}function N(e,t,s){const i=document.createElement("button");i.className="w-12 h-12 border border-gray-300 dark:border-gray-700 rounded hover:border-blue-500 dark:hover:border-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/40 flex items-center justify-center relative shape-button";let o=null;return window.SVGUtils&&window.SVGUtils.createSVGElement&&(o=window.SVGUtils.createSVGElement(e,t,s.shape_name,"w-8 h-8 object-contain")),o?(o.setAttribute("alt",s.shape_name),i.appendChild(o)):(i.textContent=s.shape_name.substring(0,2),i.className+=" text-xs font-mono",console.warn(`Could not create SVG for ${e}/${t}/${s.shape_name}, using text fallback`)),i.dataset.category=e,i.dataset.angleKey=t,i.dataset.shapeName=s.shape_name,i.dataset.cellOrientation=s.cell_orientation,i.addEventListener("click",()=>ue(i,e,t,s)),i}function ue(e,t,s,i){document.querySelectorAll(".shape-selected").forEach(o=>{o.classList.remove("shape-selected","bg-blue-200","border-blue-500","dark:bg-blue-800/40","dark:border-blue-400")}),e.classList.add("shape-selected","bg-blue-200","border-blue-500","dark:bg-blue-800/40","dark:border-blue-400"),c={category:t,angleKey:s,shape:i,imagePath:`./assets/shapes/${t}/${s}/${i.shape_name}.svg`},J()}function $(e,t){if(t==="serifs"){const s=Math.floor(e/5),i=e%5;return{row:s,col:i,gridSize:5}}else if(t==="joins"){const s=Math.floor(e/4),i=e%4;return{row:s,col:i,gridSize:4}}}function M(e,t,s){const i=s==="serifs"?5:4;if(e<0||t<0||e>=i||t>=i)return null;const o=e*i+t;return document.getElementById(s+"Grid").children[o]}function _(e,t){const s=e.dataset.grid,i=parseInt(e.dataset.index),o=$(i,s),n=t.shape.width||1,r=t.shape.height||1,l=[];if(n===2&&r===1){l.push(e);const g=M(o.row,o.col+1,s);g&&l.push(g)}else if(n===1&&r===2){l.push(e);const g=M(o.row+1,o.col,s);g&&l.push(g)}else l.push(e);return l}function Q(e){if(!c)return;const t=e.currentTarget,s=t.dataset.grid,i=f.shapes[c.category].grid;if(s!==i)return;G(),window.innerWidth>=768?_(t,c).forEach(r=>{r&&(r===t?he(r,c):r.classList.add("cell-highlight-preview"))}):_(t,c).forEach(r=>{r&&r.classList.add("cell-highlight")})}function U(e){G()}function he(e,t){const s="absolute shape-preview";let i=null;window.SVGUtils&&window.SVGUtils.createSVGElement&&(i=window.SVGUtils.createSVGElement(t.category,t.angleKey,t.shape.shape_name,s)),i&&(i.setAttribute("alt",t.shape.shape_name),P(i,t),i.style.opacity="0.6",i.style.pointerEvents="none",e.appendChild(i))}function G(){document.querySelectorAll(".cell-highlight, .cell-highlight-valid, .cell-highlight-invalid, .cell-highlight-preview").forEach(e=>{e.classList.remove("cell-highlight","cell-highlight-valid","cell-highlight-invalid","cell-highlight-preview")}),document.querySelectorAll(".shape-preview").forEach(e=>{e.remove()})}function A(e){const t=e.currentTarget;if(window.isEraseMode&&window.isEraseMode()||S){me(t);return}if(I(),!c){alert("Please select a shape from the sidebar first");return}const s=t.dataset.grid,i=f.shapes[c.category].grid;if(s!==i){alert(`This shape can only be placed on the ${i} grid`);return}const o=_(t,c);if(o.some(l=>!l)){alert("Shape extends beyond grid boundaries");return}if(typeof validateShapeConnections=="function"&&!validateShapeConnections(t,c)){console.log("Placement blocked by constraints");return}const r=typeof validateShapeConnections=="function"||c.category!=="bodies"&&c.category!=="joins"||c.shape.width>1||c.shape.height>1;r&&o.forEach(l=>{l&&(l.innerHTML="")}),R(t,c,!r)}function me(e){if(B===e){e.innerHTML="",I();return}I(),e.innerHTML.trim()!==""&&(B=e,e.classList.add("cell-erase-pending"))}function I(){B&&(B.classList.remove("cell-erase-pending"),B=null)}function be(){const e=document.getElementById("desktopEraseBtn");e&&e.addEventListener("click",()=>{S=!S,I();const t=e.querySelector("span"),s=document.getElementById("desktopEraseIcon");S?(e.classList.add("bg-red-100","dark:bg-red-900"),e.classList.remove("hover:bg-gray-50","dark:hover:bg-slate-700"),e.classList.add("hover:bg-red-200","dark:hover:bg-red-800"),t&&(t.classList.remove("text-gray-700","dark:text-gray-200"),t.classList.add("text-red-700","dark:text-red-300")),s&&(s.src="/assets/icons/erasing.svg")):(e.classList.remove("bg-red-100","dark:bg-red-900"),e.classList.add("hover:bg-gray-50","dark:hover:bg-slate-700"),e.classList.remove("hover:bg-red-200","dark:hover:bg-red-800"),t&&(t.classList.remove("text-red-700","dark:text-red-300"),t.classList.add("text-gray-700","dark:text-gray-200")),s&&(s.src="/assets/icons/erase.svg"));const i=document.querySelector(".builder-grids-wrapper");i&&(S?i.style.cursor="crosshair":i.style.cursor="")})}window.isDesktopEraseMode=()=>S;function pe(e,t){const{angleKey:s,shape:i}=t,o=i.width||1,n=i.height||1,r=i.cell_orientation,l=`${o}x${n}`,g=x.positioning.joins[l];if(!g)return;const d=g[s]||g.default,a=r.includes("top")?"top":"bottom",m=d[a],b=m.vertical.split(": ");e.style[b[0]]=b[1];const h=r.includes("right")?"right":"left",p=m.horizontal[h].split(": ");e.style[p[0]]=p[1],e.style.transform=""}function P(e,t){const{category:s,angleKey:i,shape:o}=t,n=o.width||1,r=o.height||1,l=o.cell_orientation.split(" "),g=l[0],d=l[1];if(e.style.transform="",s==="joins"&&(n===2||r===2))return pe(e,t);if(s==="joins"&&n===1&&r===1){const m=x.positioning.joins["1x1"][i];if(m){const b=l.includes("top")?"top":"bottom",h=m[b];if(h){const p=h.vertical.split(": ");e.style[p[0]]=p[1];const k=l.includes("right")?"right":"left",u=h.horizontal[k].split(": ");e.style[u[0]]=u[1],e.style.transform="";return}}e.style.top="-5%",e.style.left="-5%",e.style.transform="";return}if(s==="bodies"&&(n===2||r===2)){e.style.top="0",e.style.left="0",e.style.transform="";return}if(s==="serifs"){const a=x.positioning.serifs[i];if(!a)return X(e,g,d);if(i==="22_5_deg"){const m=o.shape_name;if(a[m]){const u=a[m];u.left&&(e.style.left=u.left),u.right&&(e.style.right=u.right);const v=u.vertical[g];v&&Object.keys(v).forEach(w=>{e.style[w]=v[w]});return}if(o.cell_orientation.includes("top")||o.cell_orientation.includes("bottom")){const u=a.side,v=u[g]||u.default;Object.keys(v).forEach(L=>{L!=="transform"&&(e.style[L]=v[L])});const w=u.horizontal[d];w&&Object.keys(w).forEach(L=>{e.style[L]=w[L]});return}const h=a.regular,p=h.horizontal[d]||h.horizontal.default,k=h.vertical[g];Object.keys(p).forEach(u=>{e.style[u]=p[u]}),k&&Object.keys(k).forEach(u=>{e.style[u]=k[u]});return}if(i==="45_deg"){const m=o.shape_name,b=a[m];if(b){Object.keys(b).forEach(h=>{e.style[h]=b[h]});return}}}X(e,g,d)}function X(e,t,s){const i=x.positioning.standard,o=i.vertical[t];o&&Object.keys(o).forEach(r=>{if(r==="transform"){const l=o[r];e.style.transform=l[s]||l.default}else e.style[r]=o[r]});const n=i.horizontal[s];n&&(Object.keys(n).forEach(r=>{e.style[r]=n[r]}),s==="center"&&t!=="center"&&(e.style.transform="translateX(-50%)"))}function R(e,t,s=!1){s||(e.innerHTML="");const i="absolute";let o=null;if(window.SVGUtils&&window.SVGUtils.createSVGElement&&(o=window.SVGUtils.createSVGElement(t.category,t.angleKey,t.shape.shape_name,i)),!o){console.warn("Could not create SVG for shape:",t);const n=document.createElement("div");n.textContent=t.shape.shape_name,n.className=i+" text-xs font-mono text-center text-gray-600 dark:text-gray-300",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",e.appendChild(n);return}o.setAttribute("alt",t.shape.shape_name),P(o,t),e.appendChild(o)}function ye(){const e=document.getElementById("bodiesTab"),t=document.getElementById("joinsTab"),s=document.getElementById("bodiesContent"),i=document.getElementById("joinsContent");e&&(e.addEventListener("click",()=>{E="bodies",e.className="flex-1 py-3 px-4 bg-white dark:bg-slate-800 border-r border-gray-300 dark:border-gray-700 font-medium text-gray-900 dark:text-gray-100",t.className="flex-1 py-3 px-4 bg-gray-200 dark:bg-slate-700 font-medium text-gray-700 dark:text-gray-200",s.classList.remove("hidden"),i.classList.add("hidden"),j()}),t.addEventListener("click",()=>{E="joins",t.className="flex-1 py-3 px-4 bg-white dark:bg-slate-800 border-r border-gray-300 dark:border-gray-700 font-medium text-gray-900 dark:text-gray-100",e.className="flex-1 py-3 px-4 bg-gray-200 dark:bg-slate-700 font-medium text-gray-700 dark:text-gray-200",i.classList.remove("hidden"),s.classList.add("hidden"),j()}))}function W(e){e.preventDefault();const t=e.currentTarget;t.innerHTML=""}function J(){const e=document.getElementById("selectedShapeDisplay"),t=document.getElementById("selectedShapeInfo");c?(e.classList.remove("hidden"),t.textContent=`${c.category} > ${c.angleKey} > ${c.shape.shape_name}`):e.classList.add("hidden")}function ve(){document.getElementById("clearSelection")&&document.getElementById("clearSelection").addEventListener("click",()=>{c=null,document.querySelectorAll(".shape-selected").forEach(t=>{t.classList.remove("shape-selected","bg-blue-200","border-blue-500")}),J()})}function we(){const e=document.getElementById("previewToggle");e&&e.addEventListener("change",s=>{y=s.target.checked,document.body.classList.toggle("preview-mode",y)});const t=document.getElementById("desktopPreviewBtn");t&&t.addEventListener("click",()=>{y=!y,document.body.classList.toggle("preview-mode",y);const s=t.querySelector("span"),i=document.getElementById("desktopPreviewIcon");y?(t.classList.add("bg-blue-100","dark:bg-blue-900"),t.classList.remove("hover:bg-gray-50","dark:hover:bg-slate-700"),t.classList.add("hover:bg-blue-200","dark:hover:bg-blue-800"),s&&(s.classList.remove("text-gray-700","dark:text-gray-200"),s.classList.add("text-blue-700","dark:text-blue-300")),i&&(i.src="/assets/icons/eye-slash.svg")):(t.classList.remove("bg-blue-100","dark:bg-blue-900"),t.classList.add("hover:bg-gray-50","dark:hover:bg-slate-700"),t.classList.remove("hover:bg-blue-200","dark:hover:bg-blue-800"),s&&(s.classList.remove("text-blue-700","dark:text-blue-300"),s.classList.add("text-gray-700","dark:text-gray-200")),i&&(i.src="/assets/icons/eye.svg"))})}function j(){const e=document.getElementById("serifsGrid"),t=document.getElementById("joinsGrid");e&&(E==="bodies"?(e.style.zIndex="20",t.style.zIndex="10",e.classList.remove("grid-inactive"),e.classList.add("grid-active"),t.classList.remove("grid-active"),t.classList.add("grid-inactive")):E==="joins"&&(t.style.zIndex="20",e.style.zIndex="10",t.classList.remove("grid-inactive"),t.classList.add("grid-active"),e.classList.remove("grid-active"),e.classList.add("grid-inactive")))}document.addEventListener("DOMContentLoaded",()=>{window.SVGUtils&&window.SVGUtils.isReady&&window.SVGUtils.isReady()?T():(document.addEventListener("svgSystemReady",T),setTimeout(()=>{window.SVGUtils&&window.SVGUtils.isReady&&window.SVGUtils.isReady()&&(document.removeEventListener("svgSystemReady",T),T())},100))});window.initBuilderCore=ne;
