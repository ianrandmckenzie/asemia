(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();let r=null,d=null,m="bodies",v=!1;async function T(){await B(),I(),N(),F(),R(),K(),y()}async function B(){try{r=await(await fetch("./assets/rules.json")).json()}catch(e){console.error("Failed to load rules.json:",e)}}function I(){G(),P()}function G(){const e=document.getElementById("serifsGrid");e.innerHTML="";for(let s=0;s<25;s++){const t=document.createElement("div");t.className="w-[100px] h-[100px] relative cursor-pointer grid-cell",t.dataset.grid="serifs",t.dataset.index=s,t.addEventListener("click",z),t.addEventListener("contextmenu",S),t.addEventListener("mouseenter",E),t.addEventListener("mouseleave",w),e.appendChild(t)}}function P(){const e=document.getElementById("joinsGrid");e.innerHTML="";for(let s=0;s<16;s++){const t=document.createElement("div");t.className="w-[100px] h-[100px] relative cursor-pointer grid-cell",t.dataset.grid="joins",t.dataset.index=s,t.addEventListener("click",z),t.addEventListener("contextmenu",S),t.addEventListener("mouseenter",E),t.addEventListener("mouseleave",w),e.appendChild(t)}}function N(){M(),H(),O()}function M(){var s;const e=document.getElementById("bodiesShapes");e.innerHTML="",(s=r==null?void 0:r.shapes)!=null&&s.bodies&&Object.keys(r.shapes.bodies).forEach(t=>{if(t==="grid")return;r.shapes.bodies[t].forEach(n=>{const o=b("bodies",t,n);e.appendChild(o)})})}function H(){var s;const e=document.getElementById("serifsShapes");e.innerHTML="",(s=r==null?void 0:r.shapes)!=null&&s.serifs&&Object.keys(r.shapes.serifs).forEach(t=>{if(t==="grid")return;r.shapes.serifs[t].forEach(n=>{const o=b("serifs",t,n);e.appendChild(o)})})}function O(){var s;const e=document.getElementById("joinsShapes");e.innerHTML="",(s=r==null?void 0:r.shapes)!=null&&s.joins&&Object.keys(r.shapes.joins).forEach(t=>{if(t==="grid")return;r.shapes.joins[t].forEach(n=>{const o=b("joins",t,n);e.appendChild(o)})})}function b(e,s,t){const i=document.createElement("button");i.className="w-12 h-12 border border-gray-300 rounded hover:border-blue-500 hover:bg-blue-50 flex items-center justify-center relative shape-button";const n=document.createElement("img"),o=`./assets/shapes/${e}/${s}/${t.shape_name}.svg`;return n.src=o,n.alt=t.shape_name,n.className="w-8 h-8 object-contain",n.onerror=()=>{i.textContent=t.shape_name.substring(0,2),i.className+=" text-xs font-mono"},i.appendChild(n),i.dataset.category=e,i.dataset.angleKey=s,i.dataset.shapeName=t.shape_name,i.dataset.cellOrientation=t.cell_orientation,i.addEventListener("click",()=>$(i,e,s,t)),i}function $(e,s,t,i){document.querySelectorAll(".shape-selected").forEach(n=>{n.classList.remove("shape-selected","bg-blue-200","border-blue-500")}),e.classList.add("shape-selected","bg-blue-200","border-blue-500"),d={category:s,angleKey:t,shape:i,imagePath:`./assets/shapes/${s}/${t}/${i.shape_name}.svg`},C()}function q(e,s){if(s==="serifs"){const t=Math.floor(e/5),i=e%5;return{row:t,col:i,gridSize:5}}else if(s==="joins"){const t=Math.floor(e/4),i=e%4;return{row:t,col:i,gridSize:4}}}function _(e,s,t){const i=t==="serifs"?5:4;if(e<0||s<0||e>=i||s>=i)return null;const n=e*i+s;return document.getElementById(t+"Grid").children[n]}function L(e,s){const t=e.dataset.grid,i=parseInt(e.dataset.index),n=q(i,t),o=s.shape.width||1,l=s.shape.height||1,c=[];if(o===2&&l===1){c.push(e);const a=_(n.row,n.col+1,t);a&&c.push(a)}else if(o===1&&l===2){c.push(e);const a=_(n.row+1,n.col,t);a&&c.push(a)}else c.push(e);return c}function E(e){if(!d)return;const s=e.currentTarget,t=s.dataset.grid,i=r.shapes[d.category].grid;if(t!==i)return;j(),L(s,d).forEach(o=>{o&&o.classList.add("cell-highlight")})}function w(e){j()}function j(){document.querySelectorAll(".cell-highlight").forEach(e=>{e.classList.remove("cell-highlight")})}function z(e){if(!d){alert("Please select a shape from the sidebar first");return}const s=e.currentTarget,t=s.dataset.grid,i=r.shapes[d.category].grid;if(t!==i){alert(`This shape can only be placed on the ${i} grid`);return}const n=L(s,d);if(n.some(o=>!o)){alert("Shape extends beyond grid boundaries");return}n.forEach(o=>{o&&(o.innerHTML="")}),Y(s,d)}const f={sizing:{"2x1":"max-w-[200%] max-h-full","1x2":"max-w-full max-h-[200%]",join_112_5_2x1:"max-w-[200%] max-h-[200%]",join_112_5_1x2:"max-w-[200%] max-h-[200%]",serif_22_5_side:"max-w-full max-h-[200%]",serif_22_5_regular:"max-w-[200%] max-h-full",serif_45_regular:"max-h-full w-auto",serif_45_side:"w-full h-auto max-h-[200%]",body_1x1:"max-w-[120%] max-h-[120%]",join_1x1:"max-w-[110%] max-h-[110%]",default:"max-w-full max-h-full"},joinPositioning:{"2x1":{"67_5_deg":{top:{vertical:"bottom: 28%",horizontal:{right:"right: -5%",left:"left: -5%"}},bottom:{vertical:"top: 28%",horizontal:{right:"right: -5%",left:"left: -5%"}}},"112_5_deg":{top:{vertical:"bottom: -15%",horizontal:{right:"left: -27%",left:"right: -27%"}},bottom:{vertical:"top: -15%",horizontal:{right:"left: -27%",left:"right: -27%"}}},"135_deg":{top:{vertical:"bottom: 5%",horizontal:{right:"left: 3.5%",left:"right: 3.5%"}},bottom:{vertical:"top: 5%",horizontal:{right:"left: 3.5%",left:"right: 3.5%"}}},default:{top:{vertical:"bottom: 5%",horizontal:{right:"left: -17.5%",left:"right: -17.5%"}},bottom:{vertical:"top: 5%",horizontal:{right:"left: -17.5%",left:"right: -17.5%"}}}},"1x2":{"67_5_deg":{top:{vertical:"top: -5%",horizontal:{left:"right: 28%",right:"left: 28%"}},bottom:{vertical:"bottom: -5%",horizontal:{left:"right: 28%",right:"left: 28%"}}},"112_5_deg":{top:{vertical:"top: -17%",horizontal:{left:"right: -15%",right:"left: -15%"}},bottom:{vertical:"bottom: -17%",horizontal:{left:"right: -15%",right:"left: -15%"}}},"135_deg":{top:{vertical:"bottom: 4%",horizontal:{right:"left: 5%",left:"right: 5%"}},bottom:{vertical:"top: 4%",horizontal:{right:"left: 5%",left:"right: 5%"}}},default:{top:{vertical:"bottom: -17.5%",horizontal:{left:"right: 5%",right:"left: 5%"}},bottom:{vertical:"top: -17.5%",horizontal:{left:"right: 5%",right:"left: 5%"}}}}}};function A(e){const{category:s,angleKey:t,shape:i}=e,n=i.width||1,o=i.height||1,l=i.shape_name.startsWith("side_");if(s==="joins"&&t==="112_5_deg"){if(n===2&&o===1)return f.sizing.join_112_5_2x1;if(n===1&&o===2)return f.sizing.join_112_5_1x2}return n===2&&o===1?f.sizing["2x1"]:n===1&&o===2?f.sizing["1x2"]:s==="serifs"&&t==="22_5_deg"?l?f.sizing.serif_22_5_side:f.sizing.serif_22_5_regular:s==="serifs"&&t==="45_deg"?l?f.sizing.serif_45_side:f.sizing.serif_45_regular:s==="bodies"&&n===1&&o===1?f.sizing.body_1x1:s==="joins"&&n===1&&o===1?f.sizing.join_1x1:f.sizing.default}function X(e,s){const{angleKey:t,shape:i}=s,n=i.width||1,o=i.height||1,l=i.cell_orientation,c=`${n}x${o}`,a=f.joinPositioning[c];if(!a)return;const p=a[t]||a.default,g=l.includes("top")?"top":"bottom",u=p[g],h=u.vertical.split(": ");e.style[h[0]]=h[1];const k=l.includes("right")?"right":"left",x=u.horizontal[k].split(": ");e.style[x[0]]=x[1],e.style.transform=""}function J(e,s,t,i){const n=s.shape.cell_orientation.includes("top")||s.shape.cell_orientation.includes("bottom");if(e.style.transform="",n){switch(t){case"bottom":e.style.top="-7%",e.style.right="-4%",e.style.maxHeight="200%";break;case"top":e.style.bottom="-7%",e.style.left="-4%",e.style.maxHeight="200%";break;default:e.style.top="0";break}switch(i){case"left":e.style.left="0";break;case"right":e.style.right="0";break;case"center":e.style.left="50%",e.style.transform="translateX(-50%)";break}}else{switch(i){case"right":e.style.left="-7%",e.style.maxWidth="200%";break;case"left":e.style.right="-7%",e.style.maxWidth="200%";break;default:e.style.left="0";break}switch(t){case"top":e.style.top="0";break;case"bottom":e.style.bottom="0";break;case"center":e.style.top="50%",e.style.transform="translateY(-50%)";break}}}function W(e,s,t){switch(s){case"top":e.style.top="0",e.style.transform=t==="center"?"translateX(-50%)":"";break;case"center":e.style.top="50%",e.style.transform=t==="center"?"translate(-50%, -50%)":"translateY(-50%)";break;case"bottom":e.style.bottom="0",e.style.transform=t==="center"?"translateX(-50%)":"";break}switch(t){case"left":e.style.left="0";break;case"center":e.style.left="50%",s!=="center"&&(e.style.transform="translateX(-50%)");break;case"right":e.style.right="0";break}}function Y(e,s){e.innerHTML="";const t=document.createElement("img");t.src=s.imagePath,t.alt=s.shape.shape_name;const i="absolute object-contain "+A(s);t.className=i;const{category:n,angleKey:o,shape:l}=s,c=l.width||1,a=l.height||1,p=l.cell_orientation.split(" "),g=p[0],u=p[1];n==="joins"&&(c===2||a===2)?X(t,s):c===2&&a===1||c===1&&a===2?(t.style.top="0",t.style.left="0",t.style.transform=""):n==="serifs"&&o==="22_5_deg"?J(t,s,g,u):n==="joins"&&c===1&&a===1?(t.style.top="-5%",t.style.left="-5%",t.style.transform=""):W(t,g,u),t.onerror=()=>{t.style.display="none";const h=document.createElement("div");h.textContent=s.shape.shape_name,h.className="absolute text-xs font-mono text-center w-full text-gray-600",h.style.top="50%",h.style.transform="translateY(-50%)",e.appendChild(h)},e.appendChild(t)}function F(){const e=document.getElementById("bodiesTab"),s=document.getElementById("joinsTab"),t=document.getElementById("bodiesContent"),i=document.getElementById("joinsContent");e.addEventListener("click",()=>{m="bodies",e.className="flex-1 py-3 px-4 bg-white border-r border-gray-300 font-medium text-gray-900",s.className="flex-1 py-3 px-4 bg-gray-200 font-medium text-gray-700",t.classList.remove("hidden"),i.classList.add("hidden"),y()}),s.addEventListener("click",()=>{m="joins",s.className="flex-1 py-3 px-4 bg-white border-r border-gray-300 font-medium text-gray-900",e.className="flex-1 py-3 px-4 bg-gray-200 font-medium text-gray-700",i.classList.remove("hidden"),t.classList.add("hidden"),y()})}function S(e){e.preventDefault();const s=e.currentTarget;s.innerHTML=""}function C(){const e=document.getElementById("selectedShapeDisplay"),s=document.getElementById("selectedShapeInfo");d?(e.classList.remove("hidden"),s.textContent=`${d.category} > ${d.angleKey} > ${d.shape.shape_name}`):e.classList.add("hidden")}function R(){document.getElementById("clearSelection").addEventListener("click",()=>{d=null,document.querySelectorAll(".shape-selected").forEach(e=>{e.classList.remove("shape-selected","bg-blue-200","border-blue-500")}),C()})}function K(){document.getElementById("previewToggle").addEventListener("change",s=>{v=s.target.checked,document.body.classList.toggle("preview-mode",v)})}function y(){const e=document.getElementById("serifsGrid"),s=document.getElementById("joinsGrid");m==="bodies"?(e.style.zIndex="20",s.style.zIndex="10",e.classList.remove("grid-inactive"),e.classList.add("grid-active"),s.classList.remove("grid-active"),s.classList.add("grid-inactive")):m==="joins"&&(s.style.zIndex="20",e.style.zIndex="10",s.classList.remove("grid-inactive"),s.classList.add("grid-active"),e.classList.remove("grid-active"),e.classList.add("grid-inactive"))}document.addEventListener("DOMContentLoaded",T);
