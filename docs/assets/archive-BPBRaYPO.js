import{i as E,a as C}from"./components-BujkCZtq.js";import"./svg-ckjYZtu2.js";import"./storage-D8keKZzz.js";import{i as k,s as L,a as S,b as $,u,c as j,g as N}from"./mobile_controls-DF0OqE54.js";async function f(){console.log("Initializing archive...");const t=document.getElementById("loading");t.innerHTML=`
    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
    <p class="mt-4 text-gray-600 dark:text-gray-300">Loading builder core...</p>
  `;try{if(window.initBuilderCore)await window.initBuilderCore();else throw new Error("Builder core not available");t.innerHTML=`
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
      <p class="mt-4 text-gray-600 dark:text-gray-300">Loading archived forms...</p>
    `,await x()}catch(n){console.error("Failed to initialize archive:",n),t.innerHTML=`
      <div class="text-red-500 text-xl mb-4">‚ö†Ô∏è</div>
      <p class="text-gray-600 dark:text-gray-300 mb-4">Failed to initialize archive</p>
      <p class="text-gray-500 dark:text-gray-400 text-sm">Error: ${n.message}</p>
    `}}async function x(){var o;const t=document.getElementById("loading");document.getElementById("error");const n=document.getElementById("archive-grid"),i=document.getElementById("archive-forms");try{const a=[];let d;try{const e=await fetch("./archive/manifest.json");if(e.ok)d=(await e.json()).files,console.log(`üìã Loaded manifest with ${d.length} files`);else throw new Error("Manifest not found")}catch(e){console.warn("Could not load manifest, falling back to hardcoded list:",e),d=["cam.json","cam_v2.json","pyraflare.json","apek.json","phoenetic/A.json","phoenetic/B.json","phoenetic/C.json"]}for(const e of d)try{console.log(`Attempting to load: ./archive/${e}`);const r=await fetch(`./archive/${e}`);if(r.ok){const s=await r.json();s.filename=e,s.source="archive",a.push(s),console.log(`‚úÖ Loaded ${e}:`,((o=s.metadata)==null?void 0:o.name)||"Unknown")}else console.warn(`‚ùå Failed to load ${e}: ${r.status} ${r.statusText}`)}catch(r){console.warn(`‚ùå Error loading ${e}:`,r)}console.log(`Total compositions loaded from archive: ${a.length}`);try{if(window.getAllCompositions){const e=await window.getAllCompositions();console.log(`üì¶ Found ${e.length} compositions in browser storage`),e.forEach((r,s)=>{var l;r.source="browser",r.filename=`browser-${r.id||s}`,a.push(r),console.log("‚úÖ Loaded from browser:",((l=r.metadata)==null?void 0:l.name)||"Unknown")})}else console.warn("Browser storage not available (getAllCompositions function not found)")}catch(e){console.warn("Could not load compositions from browser storage:",e)}if(console.log(`Total compositions loaded: ${a.length} (archive + browser)`),a.length===0)throw new Error("No compositions could be loaded");t.classList.add("hidden"),n.classList.remove("hidden"),i.innerHTML="",a.forEach((e,r)=>{var l;console.log(`Creating form element ${r+1}/${a.length}:`,(l=e.metadata)==null?void 0:l.name);const s=B(e);i.appendChild(s)}),console.log(`üéâ Successfully loaded ${a.length} archived forms`),k("5xl","5xl"),F(),L(),S(".archive-grids-wrapper"),$(".archive-grid-cell",u),j(N(),".archive-grids-wrapper")}catch(a){console.error("Failed to load archived forms:",a),t.classList.add("hidden"),T()}}function B(t){var h,p,g,c;const n=document.createElement("div");n.className="bg-white dark:bg-slate-800 rounded-lg shadow-md border border-gray-200 dark:border-slate-700 p-6";const i=document.createElement("div");i.className="mb-6";const o=document.createElement("div");o.className="flex items-center gap-3 mb-2";const a=document.createElement("h2");if(a.className="text-xl font-bold text-gray-900 dark:text-gray-100",a.textContent=((h=t.metadata)==null?void 0:h.name)||"Untitled",o.appendChild(a),t.source==="browser"){const m=document.createElement("span");m.className="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",m.textContent="Made by you!",o.appendChild(m)}const d=document.createElement("div");if(d.className="text-sm text-gray-600 dark:text-gray-400 flex flex-wrap gap-4",(p=t.metadata)!=null&&p.created){const m=new Date(t.metadata.created),y=document.createElement("span");y.textContent=`Created: ${m.toLocaleDateString()}`,d.appendChild(y)}if(t.source==="archive"){const m=document.createElement("span");m.textContent=`File: ${t.filename}`,d.appendChild(m)}i.appendChild(o),i.appendChild(d),n.appendChild(i);const e=document.createElement("div");e.className="relative bg-gray-50 dark:bg-slate-900 rounded-lg p-4 flex items-center justify-center max-h-[300px] md:max-h-none overflow-hidden",e.style.minHeight="400px";const r=document.createElement("div");r.className="relative archive-grids-wrapper",r.style.transform="scale(0.3)";const s=document.createElement("div");s.className="grid grid-cols-5 gap-0 z-10",s.style.width="500px",s.style.height="500px",s.id=`serifs-${t.filename.replace(".json","")}`;const l=document.createElement("div");return l.className="absolute grid grid-cols-4 gap-0 z-0",l.style.width="400px",l.style.height="400px",l.style.top="50px",l.style.left="50px",l.id=`joins-${t.filename.replace(".json","")}`,v(s,25),v(l,16),r.appendChild(s),r.appendChild(l),e.appendChild(r),n.appendChild(e),(g=t.grids)!=null&&g.serifs&&b(s,t.grids.serifs),(c=t.grids)!=null&&c.joins&&b(l,t.grids.joins),n}function v(t,n){for(let i=0;i<n;i++){const o=document.createElement("div");o.className="w-[100px] h-[100px] relative archive-grid-cell",o.dataset.index=i,t.appendChild(o)}}function b(t,n){const i={};n.shapes.forEach(o=>{i[o.index]||(i[o.index]=[]),i[o.index].push(o)}),Object.keys(i).forEach(o=>{const a=t.children[o];if(!a)return;i[o].forEach((e,r)=>{var l,h,p;const s={category:e.category,angleKey:e.angleKey,shape:{shape_name:e.shapeName},imagePath:e.imagePath};if((p=(h=(l=window.rulesData)==null?void 0:l.shapes)==null?void 0:h[e.category])!=null&&p[e.angleKey]){const g=window.rulesData.shapes[e.category][e.angleKey].find(c=>c.shape_name===e.shapeName);if(g){s.shape=g;const c=r>0;A(a,s,c)}else{console.warn("Shape not found in rulesData:",e.shapeName);const c=r>0;w(a,e.shapeName,c)}}else{console.warn("Category/angleKey not found in rulesData:",e.category,e.angleKey);const g=r>0;w(a,e.shapeName,g)}})})}function A(t,n,i=!1){i||(t.innerHTML="");const o="absolute";let a=null;if(window.SVGUtils&&window.SVGUtils.createSVGElement&&(a=window.SVGUtils.createSVGElement(n.category,n.angleKey,n.shape.shape_name,o)),!a){console.warn("Could not create SVG for shape:",n),w(t,n.shape.shape_name,i);return}a.setAttribute("alt",n.shape.shape_name),window.applyPositioning?window.applyPositioning(a,n):(a.style.width="100%",a.style.height="100%",a.style.top="0",a.style.left="0"),t.appendChild(a)}function w(t,n,i=!1){i||(t.innerHTML="");const o=document.createElement("div");o.textContent=n.substring(0,4),o.className="absolute inset-0 flex items-center justify-center text-xs font-mono text-gray-600 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded",t.appendChild(o)}function T(){const t=document.getElementById("loading"),n=document.getElementById("error");t.classList.add("hidden"),n.classList.remove("hidden")}function F(){const t=document.getElementById("bordersToggle");if(!t){console.warn("Borders toggle not found");return}u(t.checked),t.addEventListener("change",n=>{u(n.target.checked)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",f):f();window.initArchive=f;window.loadArchivedForms=x;E();C();
