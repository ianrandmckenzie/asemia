import{i as E,a as C}from"./components-DkINTHxm.js";import"./svg-ckjYZtu2.js";import"./builder-D23-A9aE.js";import"./storage-BmQUty4t.js";import{i as k,s as S,a as j,b as L,u as c,c as N,g as $}from"./mobile_controls-BkOJlejW.js";async function m(){console.log("Initializing archive...");const e=document.getElementById("loading");e.innerHTML=`
    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
    <p class="mt-4 text-gray-600 dark:text-gray-300">Loading builder core...</p>
  `;try{if(window.initBuilderCore)await window.initBuilderCore();else throw new Error("Builder core not available");e.innerHTML=`
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
      <p class="mt-4 text-gray-600 dark:text-gray-300">Loading archived forms...</p>
    `,await x()}catch(a){console.error("Failed to initialize archive:",a),e.innerHTML=`
      <div class="text-red-500 text-xl mb-4">‚ö†Ô∏è</div>
      <p class="text-gray-600 dark:text-gray-300 mb-4">Failed to initialize archive</p>
      <p class="text-gray-500 dark:text-gray-400 text-sm">Error: ${a.message}</p>
    `}}async function x(){var n;const e=document.getElementById("loading");document.getElementById("error");const a=document.getElementById("archive-grid"),t=document.getElementById("archive-forms");try{let s;try{const r=await fetch("./archive/manifest.json");if(r.ok)s=(await r.json()).files,console.log(`üìã Loaded manifest with ${s.length} files`);else throw new Error("Manifest not found")}catch(r){console.warn("Could not load manifest, falling back to hardcoded list:",r),s=["cam.json","cam_v2.json","pyraflare.json","apek.json","phoenetic/A.json","phoenetic/B.json","phoenetic/C.json"]}const d=[];for(const r of s)try{console.log(`Attempting to load: ./archive/${r}`);const i=await fetch(`./archive/${r}`);if(i.ok){const o=await i.json();o.filename=r,d.push(o),console.log(`‚úÖ Loaded ${r}:`,((n=o.metadata)==null?void 0:n.name)||"Unknown")}else console.warn(`‚ùå Failed to load ${r}: ${i.status} ${i.statusText}`)}catch(i){console.warn(`‚ùå Error loading ${r}:`,i)}if(console.log(`Total compositions loaded: ${d.length}`),d.length===0)throw new Error("No compositions could be loaded");e.classList.add("hidden"),a.classList.remove("hidden"),t.innerHTML="",d.forEach((r,i)=>{var l;console.log(`Creating form element ${i+1}/${d.length}:`,(l=r.metadata)==null?void 0:l.name);const o=B(r);t.appendChild(o)}),console.log(`üéâ Successfully loaded ${d.length} archived forms`),k("5xl","5xl"),z(),S(),j(".archive-grids-wrapper"),L(".archive-grid-cell",c),N($(),".archive-grids-wrapper")}catch(s){console.error("Failed to load archived forms:",s),e.classList.add("hidden"),T()}}function B(e){var h,p,u,f;const a=document.createElement("div");a.className="bg-white dark:bg-slate-800 rounded-lg shadow-md border border-gray-200 dark:border-slate-700 p-6";const t=document.createElement("div");t.className="mb-6";const n=document.createElement("h2");n.className="text-xl font-bold text-gray-900 dark:text-gray-100 mb-2",n.textContent=((h=e.metadata)==null?void 0:h.name)||"Untitled";const s=document.createElement("div");if(s.className="text-sm text-gray-600 dark:text-gray-400 flex flex-wrap gap-4",(p=e.metadata)!=null&&p.created){const b=new Date(e.metadata.created),y=document.createElement("span");y.textContent=`Created: ${b.toLocaleDateString()}`,s.appendChild(y)}const d=document.createElement("span");d.textContent=`File: ${e.filename}`,s.appendChild(d),t.appendChild(n),t.appendChild(s),a.appendChild(t);const r=document.createElement("div");r.className="relative bg-gray-50 dark:bg-slate-900 rounded-lg p-4 flex items-center justify-center max-h-[300px] md:max-h-none overflow-hidden",r.style.minHeight="400px";const i=document.createElement("div");i.className="relative archive-grids-wrapper",i.style.transform="scale(0.3)";const o=document.createElement("div");o.className="grid grid-cols-5 gap-0 z-10",o.style.width="500px",o.style.height="500px",o.id=`serifs-${e.filename.replace(".json","")}`;const l=document.createElement("div");return l.className="absolute grid grid-cols-4 gap-0 z-0",l.style.width="400px",l.style.height="400px",l.style.top="50px",l.style.left="50px",l.id=`joins-${e.filename.replace(".json","")}`,w(o,25),w(l,16),i.appendChild(o),i.appendChild(l),r.appendChild(i),a.appendChild(r),(u=e.grids)!=null&&u.serifs&&v(o,e.grids.serifs),(f=e.grids)!=null&&f.joins&&v(l,e.grids.joins),a}function w(e,a){for(let t=0;t<a;t++){const n=document.createElement("div");n.className="w-[100px] h-[100px] relative archive-grid-cell",n.dataset.index=t,e.appendChild(n)}}function v(e,a){a.shapes.forEach(t=>{var s,d,r;const n=e.children[t.index];if(n){const i={category:t.category,angleKey:t.angleKey,shape:{shape_name:t.shapeName},imagePath:t.imagePath};if((r=(d=(s=window.rulesData)==null?void 0:s.shapes)==null?void 0:d[t.category])!=null&&r[t.angleKey]){const o=window.rulesData.shapes[t.category][t.angleKey].find(l=>l.shape_name===t.shapeName);o?(i.shape=o,F(n,i)):(console.warn("Shape not found in rulesData:",t.shapeName),g(n,t.shapeName))}else console.warn("Category/angleKey not found in rulesData:",t.category,t.angleKey),g(n,t.shapeName)}})}function F(e,a){e.innerHTML="";const t="absolute";let n=null;if(window.SVGUtils&&window.SVGUtils.createSVGElement&&(n=window.SVGUtils.createSVGElement(a.category,a.angleKey,a.shape.shape_name,t)),!n){console.warn("Could not create SVG for shape:",a),g(e,a.shape.shape_name);return}n.setAttribute("alt",a.shape.shape_name),window.applyPositioning?window.applyPositioning(n,a):(n.style.width="100%",n.style.height="100%",n.style.top="0",n.style.left="0"),e.appendChild(n)}function g(e,a){const t=document.createElement("div");t.textContent=a.substring(0,4),t.className="absolute inset-0 flex items-center justify-center text-xs font-mono text-gray-600 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded",e.appendChild(t)}function T(){const e=document.getElementById("loading"),a=document.getElementById("error");e.classList.add("hidden"),a.classList.remove("hidden")}function z(){const e=document.getElementById("bordersToggle");if(!e){console.warn("Borders toggle not found");return}c(e.checked),e.addEventListener("change",a=>{c(a.target.checked)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",m):m();window.initArchive=m;window.loadArchivedForms=x;E();C();
