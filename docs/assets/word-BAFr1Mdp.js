import{i as C,a as $}from"./components-BnrkmWez.js";import"./svg-ckjYZtu2.js";import"./storage-Vn0rREE0.js";import{i as k,g as v,s as B,a as S,b as L,u as f,d as G}from"./mobile_controls-DF0OqE54.js";async function h(){console.log("Initializing word generator...");const o=document.getElementById("loading");o.innerHTML=`
    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
    <p class="mt-4 text-gray-600 dark:text-gray-300">Loading builder core...</p>
  `;try{if(window.initBuilderCore)await window.initBuilderCore();else throw new Error("Builder core not available");o.innerHTML=`
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
      <p class="mt-4 text-gray-600 dark:text-gray-300">Loading archived forms...</p>
    `,await j(),m(),k("base","base"),g(v(),".word-grids-wrapper"),z()}catch(n){console.error("Failed to initialize word generator:",n),o.innerHTML=`
      <div class="inline-block w-12 h-12 mb-4">
        <img src="assets/icons/warning.svg" alt="Warning" class="w-full h-full text-red-500">
      </div>
      <p class="text-gray-600 dark:text-gray-300 mb-4">Failed to initialize word generator</p>
      <p class="text-gray-500 dark:text-gray-400 text-sm">Error: ${n.message}</p>
    `}}let u=[];async function j(){try{const o=[];let n;try{const t=await fetch("./archive/manifest.json");if(t.ok)n=(await t.json()).files;else throw new Error("Manifest not found")}catch(t){console.warn("Could not load manifest, falling back to hardcoded list:",t),n=["apek.json","cam.json","cam_v2.json","pyraflare.json","phoenetic/A.json","phoenetic/B.json","phoenetic/C.json"]}for(const t of n)try{console.log(`Attempting to load: ./archive/${t}`);const e=await fetch(`./archive/${t}`);if(e.ok){const r=await e.json();r.filename=t,r.source="archive",o.push(r)}else console.warn(`[FAILED] Failed to load ${t}: ${e.status} ${e.statusText}`)}catch(e){console.warn(`[ERROR] Error loading ${t}:`,e)}console.log(`Total compositions loaded from archive: ${o.length}`);try{window.getAllCompositions?(await window.getAllCompositions()).forEach(e=>{e.source="browser",o.push(e)}):console.warn("Browser storage not available (getAllCompositions function not found)")}catch(t){console.warn("Could not load compositions from browser storage:",t)}if(console.log(`Total compositions loaded: ${o.length} (archive + browser)`),o.length===0)throw new Error("No compositions could be loaded");u=o}catch(o){throw console.error("Failed to load archived forms:",o),o}}function m(){const o=document.getElementById("loading"),n=document.getElementById("words-grid"),t=document.getElementById("words-container"),e=document.getElementById("wordCount"),r=parseInt((e==null?void 0:e.value)||6);o.classList.add("hidden"),n.classList.remove("hidden"),t.innerHTML="";for(let i=0;i<r;i++){const s=K(i);t.appendChild(s)}g(v()),console.log(`Generated ${r} random words`)}function K(o){const n=document.createElement("div");n.className="bg-white dark:bg-slate-800 rounded-lg shadow-md border border-gray-200 dark:border-slate-700 p-2 md:p-6";const t=Math.floor(Math.random()*4)+2,e=document.createElement("div");e.className="mb-4 text-center";const r=document.createElement("h3");r.className="text-lg font-semibold text-gray-900 dark:text-gray-100",r.textContent=`Word ${o+1}`;const i=document.createElement("div");i.className="text-sm text-gray-600 dark:text-gray-400 mt-1",i.textContent=`${t} form${t>1?"s":""}`,e.appendChild(r),e.appendChild(i),n.appendChild(e);const s=document.createElement("div");s.className="relative bg-gray-50 dark:bg-slate-900 rounded-lg p-4 flex items-center justify-center overflow-x-auto",s.style.minHeight="350px";const l=document.createElement("div");l.className="flex items-center justify-center word-forms-wrapper",l.style.gap="calc(0.3 * 8px)";for(let a=0;a<t;a++){const d=M();l.appendChild(d)}return s.appendChild(l),n.appendChild(s),n}function M(){var i,s;const o=u[Math.floor(Math.random()*u.length)],n=document.createElement("div");n.className="inline-block",n.style.width="150px",n.style.height="150px",n.style.overflow="hidden";const t=document.createElement("div");t.className="relative word-grids-wrapper",t.style.transform="scale(0.3)",t.style.transformOrigin="top left";const e=document.createElement("div");e.className="grid grid-cols-5 gap-0 z-10",e.style.width="500px",e.style.height="500px";const r=document.createElement("div");return r.className="absolute grid grid-cols-4 gap-0 z-0",r.style.width="400px",r.style.height="400px",r.style.top="50px",r.style.left="50px",b(e,25),b(r,16),t.appendChild(e),t.appendChild(r),n.appendChild(t),(i=o.grids)!=null&&i.serifs&&x(e,o.grids.serifs),(s=o.grids)!=null&&s.joins&&x(r,o.grids.joins),N(n,e),n}function N(o,n){const t=[!1,!1,!1,!1,!1];for(let a=0;a<25;a++){const d=n.children[a],c=a%5;d&&d.children.length>0&&(t[c]=!0)}let e=0;for(let a=0;a<5&&!t[a];a++)e++;let r=0;for(let a=4;a>=0&&!t[a];a--)r++;const i=50,s=e*i,l=r*i;s>0&&(o.style.marginLeft=`-${s}px`),l>0&&(o.style.marginRight=`-${l}px`),o.dataset.leftKern=s,o.dataset.rightKern=l,console.log(`Applied kerning: left=${e} cols (-${s}px), right=${r} cols (-${l}px)`)}function b(o,n){const t=G();for(let e=0;e<n;e++){const r=document.createElement("div");r.className=`w-[100px] h-[100px] relative word-grid-cell ${t}`,r.dataset.index=e,o.appendChild(r)}}function x(o,n){const t={};n.shapes.forEach(e=>{t[e.index]||(t[e.index]=[]),t[e.index].push(e)}),Object.keys(t).forEach(e=>{const r=o.children[e];if(!r)return;t[e].forEach((s,l)=>{var d,c,w;const a={category:s.category,angleKey:s.angleKey,shape:{shape_name:s.shapeName},imagePath:s.imagePath};if((w=(c=(d=window.rulesData)==null?void 0:d.shapes)==null?void 0:c[s.category])!=null&&w[s.angleKey]){const y=window.rulesData.shapes[s.category][s.angleKey].find(p=>p.shape_name===s.shapeName);if(y){a.shape=y;const p=l>0;W(r,a,p)}else console.warn("Shape not found in rulesData:",s.shapeName)}else console.warn("Category/angleKey not found in rulesData:",s.category,s.angleKey)})})}function W(o,n,t=!1){t||(o.innerHTML="");const e="absolute";let r=null;if(window.SVGUtils&&window.SVGUtils.createSVGElement&&(r=window.SVGUtils.createSVGElement(n.category,n.angleKey,n.shape.shape_name,e)),!r){console.warn("Could not create SVG for shape:",n);return}r.setAttribute("alt",n.shape.shape_name),window.applyPositioning?window.applyPositioning(r,n):(r.style.width="100%",r.style.height="100%",r.style.top="0",r.style.left="0"),o.appendChild(r)}function z(){const o=document.getElementById("sticky-subnav");if(!o){console.warn("Sticky subnav not found");return}window.innerWidth<768||o.classList.remove("hidden"),B(g),S(".word-grids-wrapper",g),F(),L(".word-grid-cell",f);const t=document.getElementById("generateBtn");t&&t.addEventListener("click",m);const e=document.getElementById("mobileGenerateBtn");e&&e.addEventListener("click",m)}const E={"7xl":.6,"6xl":.5,"5xl":.4,"4xl":.3,"3xl":.25,"2xl":.2,xl:.167,lg:.15,base:.133,sm:.117,xs:.1};function g(o){const n=E[o]||E["4xl"],t=document.querySelectorAll(".word-grids-wrapper"),e=document.querySelectorAll(".word-forms-wrapper"),r=500*n;t.forEach(s=>{if(s.style.transform=`scale(${n})`,s.parentElement){const l=s.parentElement;l.style.width=`${r}px`,l.style.height=`${r}px`;const a=parseFloat(l.dataset.leftKern||0),d=parseFloat(l.dataset.rightKern||0);a>0&&(l.style.marginLeft=`-${a*n}px`),d>0&&(l.style.marginRight=`-${d*n}px`)}});const i=`calc(${n} * 8px)`;e.forEach(s=>{s.style.gap=i}),console.log(`Size changed to ${o} (scale: ${n}, size: ${r}px, gap: ${i}) for ${t.length} forms`)}function F(){const o=document.getElementById("bordersToggle");if(!o){console.warn("Borders toggle not found");return}f(o.checked,".word-grid-cell"),o.addEventListener("change",n=>{f(n.target.checked,".word-grid-cell")})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",h):h();window.initWordGenerator=h;window.generateWords=m;C();$();
