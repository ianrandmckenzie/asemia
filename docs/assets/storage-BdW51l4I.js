const de={"7xl":.6,"6xl":.5,"5xl":.4,"4xl":.3,"3xl":.25,"2xl":.2,xl:.167,lg:.15,base:.133,sm:.117,xs:.1};let Q="7xl",B=!1;async function ee(){if(!document.getElementById("mobileSerifTab")){console.log("Mobile builder not needed on this page (no shape tabs found)");return}if(!window.rulesData){console.warn("rulesData not available yet, waiting..."),setTimeout(ee,50);return}je(),Oe(),He(),ue(),window.addEventListener("resize",ue),q("serifs"),console.log("Mobile builder initialized")}function je(){const e=document.getElementById("mobileSerifTab"),t=document.getElementById("mobileBodiesTab"),o=document.getElementById("mobileJoinsTab"),r=document.getElementById("mobileTexturesTab");e&&(X("serifs","mobileSerifShapes"),X("bodies","mobileBodiesShapes"),X("joins","mobileJoinsShapes"),Me("mobileTexturesShapes"),e.addEventListener("click",()=>q("serifs")),t.addEventListener("click",()=>q("bodies")),o.addEventListener("click",()=>q("joins")),r.addEventListener("click",()=>q("textures")))}function X(e,t){var s;const o=document.getElementById(t);if(!o||!((s=window.rulesData)!=null&&s.shapes))return;const r=e.charAt(0).toUpperCase()+e.slice(1);o.innerHTML=`
    <button id="mobile${r}EraseBtn" class="mobile-shape-btn flex-shrink-0">
      <img src="/assets/icons/erase.svg" alt="Erase ${r}" class="w-6 h-6 dark:invert">
    </button>
  `;const a=window.rulesData.shapes[e];a&&Object.keys(a).forEach(i=>{if(i==="grid")return;a[i].forEach(l=>{const d=$e(e,i,l);o.appendChild(d)})})}function Me(e){var a;const t=document.getElementById(e);if(!t)return;t.innerHTML="";const o=Ae();t.appendChild(o);const r=Ge();t.appendChild(r),(a=window.texturesData)!=null&&a.textures&&window.texturesData.textures.forEach(s=>{const i=_e(s);t.appendChild(i)})}function Ae(){const e=document.createElement("div");e.className="flex gap-2 mb-3 pr-2";const t=ce("Black","#000000","black");e.appendChild(t);const o=ce("White","#FFFFFF","white");e.appendChild(o);const r=Ie();return e.appendChild(r),e}function ce(e,t,o){const r=document.createElement("button");r.className="mobile-shape-btn flex-shrink-0 overflow-hidden flex flex-col",r.dataset.category="textures",r.dataset.colorId=o,r.dataset.colorValue=t;const a=document.createElement("div");a.className="flex-1 w-full",a.style.backgroundColor=t,o==="white"&&(a.style.border="1px solid #d1d5db");const s=document.createElement("div");return s.className="text-[10px] font-medium py-0.5",s.textContent=e,r.appendChild(a),r.appendChild(s),r.addEventListener("click",()=>{he(r,{type:"color",id:o,name:e,color:t})}),r}function Ie(){const e=document.createElement("button");e.className="mobile-shape-btn flex-shrink-0 overflow-hidden flex flex-col relative",e.dataset.category="textures",e.type="button";const t=document.createElement("div");t.className="flex-1 w-full relative",t.style.background="linear-gradient(135deg, #FF6B6B 0%, #4ECDC4 25%, #45B7D1 50%, #FFA07A 75%, #98D8C8 100%)";const o=document.createElement("input");o.type="color",o.className="absolute inset-0 w-full h-full opacity-0 cursor-pointer",o.value="#FF6B6B",t.appendChild(o);const r=document.createElement("div");return r.className="text-[10px] font-medium py-0.5",r.textContent="Custom",e.appendChild(t),e.appendChild(r),o.addEventListener("input",a=>{const s=a.target.value;t.style.backgroundColor=s,he(e,{type:"color",id:"custom",name:"Custom Color",color:s})}),e.addEventListener("click",a=>{a.target!==o&&o.click()}),e}function Ge(){const e=document.createElement("button");e.className="mobile-shape-btn flex-shrink-0 overflow-hidden flex flex-col items-center justify-center gap-1 bg-white dark:bg-slate-900 mr-2",e.id="mobileCleanTextureBtn",e.dataset.category="textures",e.type="button";const t=document.createElement("img");t.src="/assets/icons/clean.svg",t.alt="Clean",t.className="h-6 w-6 dark:invert";const o=document.createElement("div");return o.className="text-[10px] font-medium",o.textContent="Clean",e.appendChild(t),e.appendChild(o),e.addEventListener("click",()=>{Pe(e)}),e}function Pe(e){if(typeof T=="function"&&T(),B=!B,B){document.querySelectorAll('.mobile-shape-btn[data-category="textures"]').forEach(o=>{o.id!=="mobileCleanTextureBtn"&&o.classList.remove("selected")}),e.classList.add("selected"),window.setSelectedTexture&&window.setSelectedTexture(null);const t=document.getElementById("mobileTexturesTab");if(t){const o=t.querySelector(".flex.flex-col");if(o){const r=o.querySelector("svg, img, div.color-indicator");if(r&&!r.tagName==="svg"){const a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("class","h-6 w-auto"),a.setAttribute("fill","currentColor"),a.setAttribute("viewBox","0 0 100 100"),a.innerHTML='<rect width="40" height="40" x="0" y="0" opacity="0.8"/><rect width="40" height="40" x="60" y="0" opacity="0.5"/><rect width="40" height="40" x="0" y="60" opacity="0.3"/><rect width="40" height="40" x="60" y="60" opacity="0.9"/>',r.replaceWith(a)}}}}else e.classList.remove("selected");window.clearCleanMode&&!B&&window.clearCleanMode(),window.updateSelectedShapeDisplay&&window.updateSelectedShapeDisplay()}function he(e,t){typeof T=="function"&&T(),B=!1,document.querySelectorAll('.mobile-shape-btn[data-category="textures"]').forEach(r=>{r.classList.remove("selected")}),e.classList.add("selected");const o=document.getElementById("mobileTexturesTab");if(o){const r=o.querySelector(".flex.flex-col");if(r){const a=r.querySelector("svg, img, div.color-indicator"),s=document.createElement("div");s.className="color-indicator h-6 w-6 rounded border border-gray-300 dark:border-gray-600",s.style.backgroundColor=t.color,a&&a.replaceWith(s)}}window.setSelectedTexture&&window.setSelectedTexture(t),window.updateSelectedShapeDisplay&&window.updateSelectedShapeDisplay()}function _e(e){const t=document.createElement("button");t.className="mobile-shape-btn overflow-hidden",t.dataset.category="textures",t.dataset.textureId=e.id;const o=document.createElement("img");return o.src=`/assets/textures/${e.filename}`,o.alt=e.name,o.className="h-full w-auto object-contain pointer-events-none",t.appendChild(o),t.addEventListener("click",()=>{ze(t,e)}),t}function ze(e,t){typeof T=="function"&&T(),B=!1,document.querySelectorAll('.mobile-shape-btn[data-category="textures"]').forEach(r=>{r.classList.remove("selected")}),e.classList.add("selected");const o=document.getElementById("mobileTexturesTab");if(o){const r=o.querySelector(".flex.flex-col");if(r){const a=r.querySelector("svg, img");if(a){const s=document.createElement("img");s.src=`/assets/textures/${t.filename}`,s.alt=t.name,s.className="h-6 w-6 object-cover rounded",a.replaceWith(s)}}}window.setSelectedTexture&&window.setSelectedTexture(t),window.updateSelectedShapeDisplay&&window.updateSelectedShapeDisplay()}function $e(e,t,o){var s;const r=document.createElement("button");r.className="mobile-shape-btn",r.dataset.category=e,r.dataset.angleKey=t,r.dataset.shapeName=o.shape_name;const a=(s=window.SVGUtils)==null?void 0:s.createSVGElement(e,t,o.shape_name,"h-8 w-auto object-contain pointer-events-none");return a?r.appendChild(a):r.textContent=o.shape_name.substring(0,2),r.addEventListener("click",()=>{qe(r,e,t,o)}),r}function qe(e,t,o,r){typeof T=="function"&&T(),window.clearPendingPlacement&&window.clearPendingPlacement(),document.querySelectorAll(".mobile-shape-btn.selected").forEach(s=>{s.dataset.textureId||s.classList.remove("selected")}),document.querySelectorAll(".shape-selected").forEach(s=>{s.classList.remove("shape-selected","bg-blue-200","border-blue-500")}),e.classList.add("selected");const a={category:t,angleKey:o,shape:r,imagePath:`./assets/shapes/${t}/${o}/${r.shape_name}.svg`};window.setSelectedShape&&window.setSelectedShape(a),window.updateSelectedShapeDisplay&&window.updateSelectedShapeDisplay()}let Z=null;function q(e){const t={serifs:document.getElementById("mobileSerifTab"),bodies:document.getElementById("mobileBodiesTab"),joins:document.getElementById("mobileJoinsTab"),textures:document.getElementById("mobileTexturesTab")},o={serifs:document.getElementById("mobileSerifShapes"),bodies:document.getElementById("mobileBodiesShapes"),joins:document.getElementById("mobileJoinsShapes"),textures:document.getElementById("mobileTexturesShapes")},r=document.getElementById("mobileShapeSelectorWrapper");if(window.clearPendingPlacement&&window.clearPendingPlacement(),T(),e!=="textures"&&B){B=!1;const a=document.getElementById("mobileCleanTextureBtn");a&&a.classList.remove("selected")}if(Z===e){r&&r.classList.add("hidden"),Object.keys(t).forEach(a=>{t[a]&&(t[a].className="mobile-tab flex-1 py-3 px-2 bg-gray-200 dark:bg-slate-800 border-r border-gray-300 dark:border-gray-700")}),Object.keys(o).forEach(a=>{o[a]&&o[a].classList.add("hidden")}),Z=null;return}Object.keys(o).forEach(a=>{o[a]&&o[a].classList.add("hidden")}),r&&r.classList.remove("hidden"),o[e]&&o[e].classList.remove("hidden"),Object.keys(t).forEach(a=>{t[a]&&(a===e?t[a].className="mobile-tab flex-1 py-3 px-2 bg-white dark:bg-slate-700 border-r border-gray-300 dark:border-gray-700":t[a].className="mobile-tab flex-1 py-3 px-2 bg-gray-200 dark:bg-slate-800 border-r border-gray-300 dark:border-gray-700")}),Z=e,window.setCurrentTab&&(e==="bodies"||e==="serifs"?window.setCurrentTab("bodies"):e==="joins"&&window.setCurrentTab("joins")),window.updateGridLayers&&window.updateGridLayers()}function Oe(){const e=document.getElementById("mobileSaveMenuBtn"),t=document.getElementById("mobileSizeBtn"),o=document.getElementById("mobilePreviewBtn"),r=document.getElementById("mobileSaveMenu"),a=document.getElementById("mobileSizeMenu"),s=document.getElementById("closeSaveMenu"),i=document.getElementById("closeSizeMenu");if(e&&r&&s&&(e.addEventListener("click",()=>{const l=r.classList.contains("hidden"),d=r.querySelector(".absolute");l?(r.classList.remove("hidden"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{d.classList.remove("translate-y-full"),d.classList.add("translate-y-0")})})):(r.classList.add("opacity-0"),d.classList.remove("translate-y-0"),d.classList.add("translate-y-full"),setTimeout(()=>{r.classList.add("hidden"),r.classList.remove("opacity-0")},200))}),s.addEventListener("click",()=>{const l=r.querySelector(".absolute");r.classList.add("opacity-0"),l.classList.remove("translate-y-0"),l.classList.add("translate-y-full"),setTimeout(()=>{r.classList.add("hidden"),r.classList.remove("opacity-0")},150)}),r.addEventListener("click",l=>{if(l.target===r){const d=r.querySelector(".absolute");r.classList.add("opacity-0"),d.classList.remove("translate-y-0"),d.classList.add("translate-y-full"),setTimeout(()=>{r.classList.add("hidden"),r.classList.remove("opacity-0")},150)}})),t&&a&&i&&(t.addEventListener("click",()=>{const l=a.classList.contains("hidden"),d=a.querySelector(".absolute");l?(a.classList.remove("hidden"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{d.classList.remove("translate-y-full"),d.classList.add("translate-y-0")})})):(a.classList.add("opacity-0"),d.classList.remove("translate-y-0"),d.classList.add("translate-y-full"),setTimeout(()=>{a.classList.add("hidden"),a.classList.remove("opacity-0")},200))}),i.addEventListener("click",()=>{const l=a.querySelector(".absolute");a.classList.add("opacity-0"),l.classList.remove("translate-y-0"),l.classList.add("translate-y-full"),setTimeout(()=>{a.classList.add("hidden"),a.classList.remove("opacity-0")},150)}),a.addEventListener("click",l=>{if(l.target===a){const d=a.querySelector(".absolute");a.classList.add("opacity-0"),d.classList.remove("translate-y-0"),d.classList.add("translate-y-full"),setTimeout(()=>{a.classList.add("hidden"),a.classList.remove("opacity-0")},150)}})),o){let l=!1;o.addEventListener("click",()=>{l=!l,window.setPreviewMode&&window.setPreviewMode(l);const d=o.querySelector("span"),c=document.getElementById("mobilePreviewIcon");l?(o.classList.add("bg-blue-100","dark:bg-blue-900"),d&&(d.classList.remove("text-gray-600","dark:text-gray-300"),d.classList.add("text-blue-700","dark:text-blue-300")),c&&(c.src="/assets/icons/eye-slash.svg")):(o.classList.remove("bg-blue-100","dark:bg-blue-900"),d&&(d.classList.remove("text-blue-700","dark:text-blue-300"),d.classList.add("text-gray-600","dark:text-gray-300")),c&&(c.src="/assets/icons/eye.svg"))})}const n=document.getElementById("mobileClearGridsBtn");n&&n.addEventListener("click",()=>{window.clearAllGrids&&window.clearAllGrids()}),Fe()}let S={serifs:!1,bodies:!1,joins:!1};function Fe(){const e={serifs:document.getElementById("mobileSerifsEraseBtn"),bodies:document.getElementById("mobileBodiesEraseBtn"),joins:document.getElementById("mobileJoinsEraseBtn")};Object.entries(e).forEach(([t,o])=>{o&&o.addEventListener("click",()=>{S[t]=!S[t],Object.keys(S).forEach(a=>{a!==t&&(S[a]=!1)}),window.clearPendingEraseHighlight&&window.clearPendingEraseHighlight(),window.clearPendingPlacement&&window.clearPendingPlacement(),ye();const r=document.querySelector(".builder-grids-wrapper");if(r){const a=Object.values(S).some(s=>s);r.style.cursor=a?"crosshair":""}})})}function ye(){[{category:"serifs",id:"mobileSerifsEraseBtn"},{category:"bodies",id:"mobileBodiesEraseBtn"},{category:"joins",id:"mobileJoinsEraseBtn"}].forEach(({category:t,id:o})=>{const r=document.getElementById(o);if(!r)return;const a=r.querySelector("img");S[t]?(r.classList.remove("border-gray-300","dark:border-gray-700"),r.classList.add("border-red-500","dark:border-red-400"),r.style.borderWidth="3px",r.style.boxShadow="0 0 0 2px rgb(254 202 202)",a&&(a.src="/assets/icons/erasing.svg")):(r.classList.remove("border-red-500","dark:border-red-400"),r.classList.add("border-gray-300","dark:border-gray-700"),r.style.borderWidth="",r.style.boxShadow="",a&&(a.src="/assets/icons/erase.svg"))})}function T(){S.serifs=!1,S.bodies=!1,S.joins=!1,window.clearPendingEraseHighlight&&window.clearPendingEraseHighlight(),ye();const e=document.querySelector(".builder-grids-wrapper");e&&(e.style.cursor="")}window.isEraseMode=()=>Object.values(S).some(e=>e);window.getMobileEraseCategory=()=>{for(const[e,t]of Object.entries(S))if(t)return e;return null};window.getMobileCleanMode=()=>B;window.clearMobileCleanMode=()=>{if(B){B=!1;const e=document.getElementById("mobileCleanTextureBtn");e&&e.classList.remove("selected")}};window.hideMobileSaveMenu=function(){const e=document.getElementById("mobileSaveMenu"),t=e==null?void 0:e.querySelector(".absolute");e&&t&&(e.classList.add("opacity-0"),t.classList.remove("translate-y-0"),t.classList.add("translate-y-full"),setTimeout(()=>{e.classList.add("hidden"),e.classList.remove("opacity-0")},150))};function He(){const e=document.getElementById("mobileSizeButtons");if(!e)return;["7xl","6xl","5xl","4xl","3xl","2xl","xl","lg","base","sm","xs"].forEach(o=>{const r=document.createElement("button");r.className=`px-4 py-3 rounded-lg text-sm font-medium transition-colors ${o===Q?"bg-blue-500 text-white":"bg-gray-100 dark:bg-slate-700 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-slate-600"}`,r.textContent=o,r.addEventListener("click",()=>{Q=o,we(o);const a=document.getElementById("mobileSizeMenu"),s=a.querySelector(".absolute");a.classList.add("opacity-0"),s.classList.remove("translate-y-0"),s.classList.add("translate-y-full"),setTimeout(()=>{a.classList.add("hidden"),a.classList.remove("opacity-0")},150),e.querySelectorAll("button").forEach(i=>{i===r?i.className="px-4 py-3 rounded-lg text-sm font-medium transition-colors bg-blue-500 text-white":i.className="px-4 py-3 rounded-lg text-sm font-medium transition-colors bg-gray-100 dark:bg-slate-700 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-slate-600"})}),e.appendChild(r)})}function we(e){const t=de[e]||de["5xl"],o=document.querySelector(".builder-grids-wrapper");o&&(o.style.transform=`scale(${t})`)}function ue(){if(window.innerWidth<768)we(Q);else{const t=document.querySelector(".builder-grids-wrapper");t&&(t.style.transform="scale(1)")}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{setTimeout(ee,100)}):setTimeout(ee,100);let y=null,_=null,p=null,E=null,M="bodies",N=!1,w={serifs:!1,bodies:!1,joins:!1},k=!1,O=null,F=null,U=null;const z={positioning:{joins:{"2x1":{"67_5_deg":{top:{vertical:"bottom: -14%",horizontal:{right:"right: -5%",left:"left: -5%"}},bottom:{vertical:"top: -14%",horizontal:{right:"right: -5%",left:"left: -5%"}}},"112_5_deg":{top:{vertical:"bottom: -15%",horizontal:{right:"left: -27%",left:"right: -27%"}},bottom:{vertical:"top: -15%",horizontal:{right:"left: -27%",left:"right: -27%"}}},"135_deg":{top:{vertical:"bottom: -15%",horizontal:{right:"left: -15%",left:"right: -15%"}},bottom:{vertical:"top: -15%",horizontal:{right:"left: -15%",left:"right: -15%"}}},default:{top:{vertical:"bottom: 5%",horizontal:{right:"left: -17%",left:"right: -17%"}},bottom:{vertical:"top: 5%",horizontal:{right:"left: -17%",left:"right: -17%"}}}},"1x2":{"67_5_deg":{top:{vertical:"top: -5%",horizontal:{left:"right: 27%",right:"left: 27%"}},bottom:{vertical:"bottom: -5%",horizontal:{left:"right: 27%",right:"left: 27%"}}},"112_5_deg":{top:{vertical:"top: 27%",horizontal:{left:"left: -5%",right:"right: -5%"}},bottom:{vertical:"bottom: 27%",horizontal:{left:"left: -5%",right:"right: -5%"}}},"135_deg":{top:{vertical:"bottom: -15%",horizontal:{left:"right: -15%",right:"left: -15%"}},bottom:{vertical:"top: -15%",horizontal:{left:"right: -15%",right:"left: -15%"}}},default:{top:{vertical:"bottom: -17%",horizontal:{left:"right: 5%",right:"left: 5%"}},bottom:{vertical:"top: -17%",horizontal:{left:"right: 5%",right:"left: 5%"}}}},"1x1":{"45_deg":{top:{vertical:"top: -5%",horizontal:{left:"left: -5%",right:"right: -5%"}},bottom:{vertical:"bottom: -5%",horizontal:{left:"left: -5%",right:"right: -5%"}}},"90_deg":{top:{vertical:"top: -5%",horizontal:{left:"left: -5%",right:"right: -5%"}},bottom:{vertical:"bottom: -5%",horizontal:{left:"left: -5%",right:"right: -5%"}}}}},serifs:{"22_5_deg":{br_to_tl:{type:"special",right:"-7%",vertical:{top:{top:"0"},bottom:{bottom:"0"},center:{top:"50%",transform:"translateY(-50%)"}}},tr_to_bl:{type:"special",right:"-7%",vertical:{top:{top:"0"},bottom:{bottom:"0"},center:{top:"50%",transform:"translateY(-50%)"}}},bl_to_tr:{type:"special",left:"-7%",vertical:{top:{top:"0"},bottom:{bottom:"0"},center:{top:"50%",transform:"translateY(-50%)"}}},tl_to_br:{type:"special",left:"-7%",vertical:{top:{top:"0"},bottom:{bottom:"0"},center:{top:"50%",transform:"translateY(-50%)"}}},side:{type:"side",bottom:{top:"-7%",right:"0",maxHeight:"200%"},top:{bottom:"-7%",left:"0",maxHeight:"200%"},default:{top:"0"},horizontal:{left:{left:"0"},right:{right:"0"},center:{left:"50%",transform:"translateX(-50%)"}}},regular:{type:"regular",horizontal:{right:{left:"-25%",maxWidth:"200%"},left:{right:"-25%",maxWidth:"200%"},default:{left:"0"}},vertical:{top:{top:"0"},bottom:{bottom:"0"},center:{top:"50%",transform:"translateY(-50%)"}}}},"45_deg":{tl_to_br:{right:"0%",top:"0%"},bl_to_tr:{right:"0%",bottom:"0%"},tr_to_bl:{left:"0%",top:"0%"},br_to_tl:{left:"0%",bottom:"0%"},side_tl_to_br:{right:"0%",bottom:"0%"},side_bl_to_tr:{right:"0%",top:"0%"},side_tr_to_bl:{left:"0%",bottom:"0%"},side_br_to_tl:{left:"0%",top:"0%"}}},bodies:{"2x1":{type:"topLeft"},"1x2":{type:"topLeft"},"1x1":{type:"standard"}},standard:{vertical:{top:{top:"0",transform:{center:"translateX(-50%)",default:""}},center:{top:"50%",transform:{center:"translate(-50%, -50%)",default:"translateY(-50%)"}},bottom:{bottom:"0",transform:{center:"translateX(-50%)",default:""}}},horizontal:{left:{left:"0"},center:{left:"50%"},right:{right:"0"}}}}};async function D(){await ve(),await Ue(),Ve(),Ke(),lt(),ct(),ut(),nt(),H(),window.getCellPosition=oe,window.getCellByPosition=V,window.getOccupiedCells=A,window.clearCellHighlights=K,window.placeShapeInCell=se,window.applyPositioning=J,window.applyTextureToShape=Ee,window.rulesData=y,window.texturesData=_,window.shapeConfig=z,window.getSelectedShape=()=>p,window.setSelectedShape=e=>{p=e},window.getSelectedTexture=()=>E,window.setSelectedTexture=e=>{E=e},window.handleGridCellClick=ae,window.handleGridCellRightClick=ne,window.handleGridCellLeave=re,window.clearPendingEraseHighlight=$,window.clearPendingPlacement=W,window.updateSelectedShapeDisplay=I,window.updateGridLayers=H,window.getCurrentTab=()=>M,window.setCurrentTab=e=>{M=e},window.getPreviewMode=()=>N,window.setPreviewMode=e=>{N=e,document.body.classList.toggle("preview-mode",e)},window.clearCleanMode=dt,console.log("Builder functions made globally accessible")}async function De(){await ve(),window.getCellPosition=oe,window.getCellByPosition=V,window.getOccupiedCells=A,window.clearCellHighlights=K,window.placeShapeInCell=se,window.applyPositioning=J,window.rulesData=y,window.shapeConfig=z,console.log("Builder core functions initialized")}async function ve(){try{y=await(await fetch("./assets/rules.json")).json()}catch(e){console.error("Failed to load rules.json:",e)}}async function Ue(){try{_=await(await fetch("./assets/textures/manifest.json")).json()}catch(e){console.error("Failed to load textures manifest.json:",e)}}function Ve(){We(),Re()}function We(){const e=document.getElementById("serifsGrid");if(e){e.innerHTML="";for(let t=0;t<25;t++){const o=document.createElement("div");o.className="w-[100px] h-[100px] relative cursor-pointer grid-cell",o.dataset.grid="serifs",o.dataset.index=t,o.addEventListener("click",ae),o.addEventListener("contextmenu",ne),o.addEventListener("mouseenter",xe),o.addEventListener("mouseleave",re),e.appendChild(o)}}}function Re(){const e=document.getElementById("joinsGrid");if(e){e.innerHTML="";for(let t=0;t<16;t++){const o=document.createElement("div");o.className="w-[100px] h-[100px] relative cursor-pointer grid-cell",o.dataset.grid="joins",o.dataset.index=t,o.addEventListener("click",ae),o.addEventListener("contextmenu",ne),o.addEventListener("mouseenter",xe),o.addEventListener("mouseleave",re),e.appendChild(o)}}}function Ke(){Je(),Ye(),Xe(),Ze()}function Je(){var t;const e=document.getElementById("bodiesShapes");if(e){if(e.innerHTML="",!((t=y==null?void 0:y.shapes)!=null&&t.bodies))return;Object.keys(y.shapes.bodies).forEach(o=>{if(o==="grid")return;y.shapes.bodies[o].forEach(a=>{const s=te("bodies",o,a);e.appendChild(s)})})}}function Ye(){var t;const e=document.getElementById("serifsShapes");if(e){if(e.innerHTML="",!((t=y==null?void 0:y.shapes)!=null&&t.serifs))return;Object.keys(y.shapes.serifs).forEach(o=>{if(o==="grid")return;y.shapes.serifs[o].forEach(a=>{const s=te("serifs",o,a);e.appendChild(s)})})}}function Xe(){var t;const e=document.getElementById("joinsShapes");if(e){if(e.innerHTML="",!((t=y==null?void 0:y.shapes)!=null&&t.joins))return;Object.keys(y.shapes.joins).forEach(o=>{if(o==="grid")return;y.shapes.joins[o].forEach(a=>{const s=te("joins",o,a);e.appendChild(s)})})}}function Ze(){const e=document.getElementById("texturesShapes");if(e){e.innerHTML="";const t=Qe();e.appendChild(t);const o=et();e.appendChild(o);const r=document.createElement("div");if(r.className="col-span-2 h-px bg-gray-300 dark:bg-gray-600 my-2",e.appendChild(r),!(_!=null&&_.textures))return;_.textures.forEach(a=>{const s=ot(a);e.appendChild(s)})}}function Qe(){const e=document.createElement("div");e.className="col-span-2 grid grid-cols-3 gap-2 mb-2";const t=me("Black","#000000","black");e.appendChild(t);const o=me("White","#FFFFFF","white");e.appendChild(o);const r=tt();return e.appendChild(r),e}function et(){const e=document.createElement("button");e.className="col-span-2 aspect-[6/1] rounded border-2 border-gray-300 dark:border-gray-600 hover:border-blue-500 dark:hover:border-blue-400 overflow-hidden flex items-center justify-center gap-2 relative bg-white dark:bg-slate-900",e.id="cleanTextureBtn";const t=document.createElement("img");t.src="/assets/icons/clean.svg",t.alt="Clean",t.className="h-5 w-5 dark:invert";const o=document.createElement("div");return o.className="text-sm font-medium text-gray-700 dark:text-gray-300",o.textContent="Clean",e.appendChild(t),e.appendChild(o),e.addEventListener("click",()=>{typeof C=="function"&&C(),k=!k,k?(e.classList.remove("border-gray-300","dark:border-gray-600"),e.classList.add("border-blue-500","dark:border-blue-400","bg-blue-50","dark:bg-blue-900")):(e.classList.remove("border-blue-500","dark:border-blue-400","bg-blue-50","dark:bg-blue-900"),e.classList.add("border-gray-300","dark:border-gray-600")),k&&(document.querySelectorAll("#texturesShapes button").forEach(r=>{r.id!=="cleanTextureBtn"&&(r.classList.remove("border-blue-500","dark:border-blue-400","bg-blue-50","dark:bg-blue-900"),r.classList.add("border-gray-300","dark:border-gray-600"))}),E=null),I()}),e}function me(e,t,o){const r=document.createElement("button");r.className="aspect-square rounded border-2 border-gray-300 dark:border-gray-600 hover:border-blue-500 dark:hover:border-blue-400 overflow-hidden flex flex-col items-center justify-center relative",r.dataset.colorId=o,r.dataset.colorValue=t;const a=document.createElement("div");a.className="w-full h-3/4",a.style.backgroundColor=t,o==="white"&&(a.className+=" border border-gray-300 dark:border-gray-600");const s=document.createElement("div");return s.className="w-full h-1/4 flex items-center justify-center text-xs font-medium text-gray-700 dark:text-gray-300 px-1 text-center",s.textContent=e,r.appendChild(a),r.appendChild(s),r.addEventListener("click",()=>{typeof C=="function"&&C(),k=!1,document.querySelectorAll("#texturesShapes button").forEach(i=>{i.classList.remove("border-blue-500","dark:border-blue-400","bg-blue-50","dark:bg-blue-900"),i.classList.add("border-gray-300","dark:border-gray-600")}),r.classList.remove("border-gray-300","dark:border-gray-600"),r.classList.add("border-blue-500","dark:border-blue-400","bg-blue-50","dark:bg-blue-900"),E={type:"color",id:o,name:e,color:t},I()}),r}function tt(){const e=document.createElement("button");e.className="aspect-square rounded border-2 border-gray-300 dark:border-gray-600 hover:border-blue-500 dark:hover:border-blue-400 overflow-hidden flex flex-col items-center justify-center relative",e.type="button";const t=document.createElement("div");t.className="w-full h-3/4 relative",t.style.background="linear-gradient(135deg, #FF6B6B 0%, #4ECDC4 25%, #45B7D1 50%, #FFA07A 75%, #98D8C8 100%)";const o=document.createElement("input");o.type="color",o.className="absolute inset-0 w-full h-full opacity-0 cursor-pointer",o.value="#FF6B6B",t.appendChild(o);const r=document.createElement("div");return r.className="w-full h-1/4 flex items-center justify-center text-xs font-medium text-gray-700 dark:text-gray-300 px-1 text-center",r.textContent="Custom",e.appendChild(t),e.appendChild(r),o.addEventListener("input",a=>{const s=a.target.value;t.style.backgroundColor=s,typeof C=="function"&&C(),k=!1,document.querySelectorAll("#texturesShapes button").forEach(i=>{i.classList.remove("border-blue-500","dark:border-blue-400","bg-blue-50","dark:bg-blue-900"),i.classList.add("border-gray-300","dark:border-gray-600")}),e.classList.remove("border-gray-300","dark:border-gray-600"),e.classList.add("border-blue-500","dark:border-blue-400","bg-blue-50","dark:bg-blue-900"),E={type:"color",id:"custom",name:"Custom Color",color:s},I()}),e.addEventListener("click",a=>{a.target!==o&&o.click()}),e}function ot(e){const t=document.createElement("button");t.className="w-full aspect-square rounded border-2 border-gray-300 dark:border-gray-600 hover:border-blue-500 dark:hover:border-blue-400 overflow-hidden bg-white dark:bg-slate-900 flex flex-col items-center justify-center relative";const o=document.createElement("div");o.className="w-full h-3/4 bg-cover bg-center",o.style.backgroundImage=`url('/assets/textures/${e.filename}')`;const r=document.createElement("div");return r.className="w-full h-1/4 flex items-center justify-center text-xs font-medium text-gray-700 dark:text-gray-300 px-1 text-center",r.textContent=e.name,t.appendChild(o),t.appendChild(r),t.addEventListener("click",()=>{typeof C=="function"&&C(),k=!1,document.querySelectorAll("#texturesShapes button").forEach(a=>{a.classList.remove("border-blue-500","dark:border-blue-400","bg-blue-50","dark:bg-blue-900"),a.classList.add("border-gray-300","dark:border-gray-600")}),t.classList.remove("border-gray-300","dark:border-gray-600"),t.classList.add("border-blue-500","dark:border-blue-400","bg-blue-50","dark:bg-blue-900"),E=e,I()}),t}function te(e,t,o){const r=document.createElement("button");r.className="w-12 h-12 border border-gray-300 dark:border-gray-700 rounded hover:border-blue-500 dark:hover:border-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/40 flex items-center justify-center relative shape-button";let a=null;return window.SVGUtils&&window.SVGUtils.createSVGElement&&(a=window.SVGUtils.createSVGElement(e,t,o.shape_name,"w-8 h-8 object-contain")),a?(a.setAttribute("alt",o.shape_name),r.appendChild(a)):(r.textContent=o.shape_name.substring(0,2),r.className+=" text-xs font-mono",console.warn(`Could not create SVG for ${e}/${t}/${o.shape_name}, using text fallback`)),r.dataset.category=e,r.dataset.angleKey=t,r.dataset.shapeName=o.shape_name,r.dataset.cellOrientation=o.cell_orientation,r.addEventListener("click",()=>rt(r,e,t,o)),r}function rt(e,t,o,r){typeof C=="function"&&C(),document.querySelectorAll(".shape-selected").forEach(a=>{a.classList.remove("shape-selected","bg-blue-200","border-blue-500","dark:bg-blue-800/40","dark:border-blue-400")}),e.classList.add("shape-selected","bg-blue-200","border-blue-500","dark:bg-blue-800/40","dark:border-blue-400"),p={category:t,angleKey:o,shape:r,imagePath:`./assets/shapes/${t}/${o}/${r.shape_name}.svg`},I()}function oe(e,t){if(t==="serifs"){const o=Math.floor(e/5),r=e%5;return{row:o,col:r,gridSize:5}}else if(t==="joins"){const o=Math.floor(e/4),r=e%4;return{row:o,col:r,gridSize:4}}}function V(e,t,o){const r=o==="serifs"?5:4;if(e<0||t<0||e>=r||t>=r)return null;const a=e*r+t;return document.getElementById(o+"Grid").children[a]}function A(e,t){const o=e.dataset.grid,r=parseInt(e.dataset.index),a=oe(r,o),s=t.shape.width||1,i=t.shape.height||1,n=[];if(s===2&&i===1){n.push(e);const l=V(a.row,a.col+1,o);l&&n.push(l)}else if(s===1&&i===2){n.push(e);const l=V(a.row+1,a.col,o);l&&n.push(l)}else n.push(e);return n}function xe(e){if(!p)return;const t=e.currentTarget,o=t.dataset.grid,r=y.shapes[p.category].grid;if(o!==r)return;K(),window.innerWidth>=768?A(t,p).forEach(i=>{i&&(i===t?ke(i,p):i.classList.add("cell-highlight-preview"))}):A(t,p).forEach(i=>{i&&i.classList.add("cell-highlight")})}function re(e){K()}function ke(e,t){const o="absolute shape-preview";let r=null;if(window.SVGUtils&&window.SVGUtils.createSVGElement&&(r=window.SVGUtils.createSVGElement(t.category,t.angleKey,t.shape.shape_name,o)),r){r.setAttribute("alt",t.shape.shape_name),r.removeAttribute("width"),r.removeAttribute("height");const a=r.getAttribute("viewBox");if(a){const[,,s,i]=a.split(" ").map(Number);r.style.width=`${s}px`,r.style.height=`${i}px`}J(r,t),r.style.opacity="0.6",r.style.pointerEvents="none",e.appendChild(r)}}function K(){document.querySelectorAll(".cell-highlight, .cell-highlight-valid, .cell-highlight-invalid, .cell-highlight-preview").forEach(e=>{e.classList.remove("cell-highlight","cell-highlight-valid","cell-highlight-invalid","cell-highlight-preview")}),document.querySelectorAll(".shape-preview").forEach(e=>{e.remove()}),W()}function ae(e){const t=e.currentTarget,o=window.getMobileCleanMode&&window.getMobileCleanMode();if(k||o){st(t);return}const r=w.serifs||w.bodies||w.joins;if(window.isEraseMode&&window.isEraseMode()||r){at(t);return}if($(),!p){alert("Please select a shape from the sidebar first");return}const a=t.dataset.grid,s=y.shapes[p.category].grid;if(a!==s){alert(`This shape can only be placed on the ${s} grid`);return}const i=A(t,p);if(i.some(l=>!l)){alert("Shape extends beyond grid boundaries");return}if(typeof validateShapeConnections=="function"&&!validateShapeConnections(t,p)){console.log("Placement blocked by constraints");return}if(window.innerWidth<768){if(F===t&&U===p){W(),be(t,p);return}W(),F=t,U=p,i.forEach(l=>{l&&(l===t?(ke(l,p),l.classList.add("cell-placement-pending")):l.classList.add("cell-highlight-preview"))});return}be(t,p)}function be(e,t){const o=A(e,t),a=typeof validateShapeConnections=="function"||t.category!=="bodies"&&t.category!=="joins"||t.shape.width>1||t.shape.height>1;a&&o.forEach(s=>{s&&(s.innerHTML="")}),se(e,t,!a)}function at(e){let t=null;if(w.serifs?t="serifs":w.bodies?t="bodies":w.joins&&(t="joins"),window.isEraseMode&&window.isEraseMode()){const r=window.getMobileEraseCategory?window.getMobileEraseCategory():null;r&&(t=r)}if(!t)return;if(O===e){e.querySelectorAll("[data-category]").forEach(a=>{a.dataset.category===t&&a.remove()}),e.innerHTML.trim()===""&&(e.innerHTML=""),$();return}$(),e.querySelector(`[data-category="${t}"]`)&&(O=e,e.classList.add("cell-erase-pending"))}function st(e){if(!e.hasChildNodes())return;e.querySelectorAll('[data-textured="true"]').forEach(o=>{const r=o.dataset.textureType;if(r==="image"){const a=o.dataset.category,s=o.dataset.angleKey,i=o.dataset.shapeName;if(window.SVGUtils&&window.SVGUtils.createSVGElement&&a&&s&&i){const n=window.SVGUtils.createSVGElement(a,s,i,"absolute pointer-events-none");n&&(n.style.width=o.style.width,n.style.height=o.style.height,n.style.top=o.style.top,n.style.bottom=o.style.bottom,n.style.left=o.style.left,n.style.right=o.style.right,n.style.transform=o.style.transform,n.dataset.category=a,n.dataset.angleKey=s,n.dataset.shapeName=i,o.replaceWith(n))}}else r==="color"&&(o.removeAttribute("data-textured"),o.removeAttribute("data-texture-id"),o.removeAttribute("data-texture-type"),o.removeAttribute("data-texture-color"),o.setAttribute("fill","currentColor"),o.setAttribute("stroke","currentColor"),o.querySelectorAll("*[fill], *[stroke]").forEach(s=>{s.hasAttribute("fill")&&s.getAttribute("fill")!=="none"&&s.setAttribute("fill","currentColor"),s.hasAttribute("stroke")&&s.getAttribute("stroke")!=="none"&&s.setAttribute("stroke","currentColor")}))})}function $(){O&&(O.classList.remove("cell-erase-pending"),O=null)}function W(){F&&(A(F,U).forEach(t=>{t&&(t.classList.remove("cell-placement-pending","cell-highlight-preview"),t.querySelectorAll(".shape-preview").forEach(r=>r.remove()))}),F=null,U=null)}function nt(){const e={serifs:document.getElementById("serifsEraseBtn"),bodies:document.getElementById("bodiesEraseBtn"),joins:document.getElementById("joinsEraseBtn")};Object.entries(e).forEach(([t,o])=>{o&&o.addEventListener("click",()=>{w[t]=!w[t],Object.keys(w).forEach(a=>{a!==t&&(w[a]=!1)}),$(),Ce();const r=document.querySelector(".builder-grids-wrapper");if(r){const a=Object.values(w).some(s=>s);r.style.cursor=a?"crosshair":""}})})}function Ce(){[{category:"serifs",id:"serifsEraseBtn"},{category:"bodies",id:"bodiesEraseBtn"},{category:"joins",id:"joinsEraseBtn"}].forEach(({category:t,id:o})=>{const r=document.getElementById(o);if(!r)return;const a=r.querySelector("img");w[t]?(r.classList.remove("border-gray-300","dark:border-gray-700"),r.classList.remove("hover:border-red-500","dark:hover:border-red-400"),r.classList.remove("hover:bg-red-50","dark:hover:bg-red-900/40"),r.classList.add("bg-red-200","border-red-500","dark:bg-red-800/40","dark:border-red-400"),r.classList.add("hover:bg-red-300","dark:hover:bg-red-700/40"),a&&(a.src="/assets/icons/erasing.svg")):(r.classList.remove("bg-red-200","border-red-500","dark:bg-red-800/40","dark:border-red-400"),r.classList.remove("hover:bg-red-300","dark:hover:bg-red-700/40"),r.classList.add("border-gray-300","dark:border-gray-700"),r.classList.add("hover:border-red-500","dark:hover:border-red-400"),r.classList.add("hover:bg-red-50","dark:hover:bg-red-900/40"),a&&(a.src="/assets/icons/erase.svg"))})}window.isDesktopEraseMode=()=>Object.values(w).some(e=>e);window.getActiveEraseCategory=()=>{for(const[e,t]of Object.entries(w))if(t)return e;return null};function it(e,t){const{angleKey:o,shape:r}=t,a=r.width||1,s=r.height||1,i=r.cell_orientation,n=`${a}x${s}`,l=z.positioning.joins[n];if(!l)return;const d=l[o]||l.default,c=i.includes("top")?"top":"bottom",u=d[c],m=u.vertical.split(": ");e.style[m[0]]=m[1];const g=i.includes("right")?"right":"left",f=u.horizontal[g].split(": ");e.style[f[0]]=f[1],e.style.transform=""}function J(e,t){const{category:o,angleKey:r,shape:a}=t,s=a.width||1,i=a.height||1,n=a.cell_orientation.split(" "),l=n[0],d=n[1];if(e.style.transform="",o==="joins"&&(s===2||i===2))return it(e,t);if(o==="joins"&&s===1&&i===1){const u=z.positioning.joins["1x1"][r];if(u){const m=n.includes("top")?"top":"bottom",g=u[m];if(g){const f=g.vertical.split(": ");e.style[f[0]]=f[1];const h=n.includes("right")?"right":"left",b=g.horizontal[h].split(": ");e.style[b[0]]=b[1],e.style.transform="";return}}e.style.top="-5%",e.style.left="-5%",e.style.transform="";return}if(o==="bodies"&&(s===2||i===2)){e.style.top="0",e.style.left="0",e.style.transform="";return}if(o==="serifs"){const c=z.positioning.serifs[r];if(!c)return ge(e,l,d);if(r==="22_5_deg"){const u=a.shape_name;if(c[u]){const b=c[u];b.left&&(e.style.left=b.left),b.right&&(e.style.right=b.right);const v=b.vertical[l];v&&Object.keys(v).forEach(G=>{e.style[G]=v[G]});return}if(a.cell_orientation.includes("top")||a.cell_orientation.includes("bottom")){const b=c.side,v=b[l]||b.default;Object.keys(v).forEach(P=>{P!=="transform"&&(e.style[P]=v[P])});const G=b.horizontal[d];G&&Object.keys(G).forEach(P=>{e.style[P]=G[P]});return}const g=c.regular,f=g.horizontal[d]||g.horizontal.default,h=g.vertical[l];Object.keys(f).forEach(b=>{e.style[b]=f[b]}),h&&Object.keys(h).forEach(b=>{e.style[b]=h[b]});return}if(r==="45_deg"){const u=a.shape_name,m=c[u];if(m){Object.keys(m).forEach(g=>{e.style[g]=m[g]});return}}}ge(e,l,d)}function ge(e,t,o){const r=z.positioning.standard,a=r.vertical[t];a&&Object.keys(a).forEach(i=>{if(i==="transform"){const n=a[i];e.style.transform=n[o]||n.default}else e.style[i]=a[i]});const s=r.horizontal[o];s&&(Object.keys(s).forEach(i=>{e.style[i]=s[i]}),o==="center"&&t!=="center"&&(e.style.transform="translateX(-50%)"))}function se(e,t,o=!1){o||(e.innerHTML="");const r="absolute";let a=null;if(window.SVGUtils&&window.SVGUtils.createSVGElement&&(a=window.SVGUtils.createSVGElement(t.category,t.angleKey,t.shape.shape_name,r)),!a){console.warn("Could not create SVG for shape:",t);const i=document.createElement("div");i.textContent=t.shape.shape_name,i.className=r+" text-xs font-mono text-center text-gray-600 dark:text-gray-300",i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center",e.appendChild(i);return}a.setAttribute("alt",t.shape.shape_name),a.removeAttribute("width"),a.removeAttribute("height");const s=a.getAttribute("viewBox");if(s){const[,,i,n]=s.split(" ").map(Number);a.style.width=`${i}px`,a.style.height=`${n}px`}if(J(a,t),E){const i=Ee(a,E);e.appendChild(i)}else e.appendChild(a)}function Ee(e,t){if(!e||!t)return e;if(t.type==="color"){const l=e.cloneNode(!0);return l.setAttribute("fill",t.color),l.setAttribute("stroke",t.color),l.querySelectorAll("*[fill], *[stroke]").forEach(c=>{c.getAttribute("fill")&&c.getAttribute("fill")!=="none"&&c.setAttribute("fill",t.color),c.getAttribute("stroke")&&c.getAttribute("stroke")!=="none"&&c.setAttribute("stroke",t.color)}),l.dataset.category=e.dataset.category,l.dataset.angleKey=e.dataset.angleKey,l.dataset.shapeName=e.dataset.shapeName,l.dataset.textured="true",l.dataset.textureId=t.id,l.dataset.textureType="color",l.dataset.textureColor=t.color,l}const o=e.cloneNode(!0);o.style.top="",o.style.bottom="",o.style.left="",o.style.right="",o.style.transform="",o.style.position="",o.setAttribute("fill","black"),o.setAttribute("stroke","black"),o.querySelectorAll("*[fill], *[stroke]").forEach(l=>{l.getAttribute("fill")&&l.getAttribute("fill")!=="none"&&l.setAttribute("fill","black"),l.getAttribute("stroke")&&l.getAttribute("stroke")!=="none"&&l.setAttribute("stroke","black")});const a=new XMLSerializer().serializeToString(o),i=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(a)))}`,n=document.createElement("div");return n.className="absolute",n.style.width=e.style.width,n.style.height=e.style.height,n.style.top=e.style.top||"",n.style.bottom=e.style.bottom||"",n.style.left=e.style.left||"",n.style.right=e.style.right||"",n.style.transform=e.style.transform||"",n.style.backgroundImage=`url('/assets/textures/${t.filename}')`,n.style.backgroundSize="cover",n.style.backgroundPosition="center",n.style.webkitMaskImage=`url('${i}')`,n.style.maskImage=`url('${i}')`,n.style.webkitMaskSize="100% 100%",n.style.maskSize="100% 100%",n.style.webkitMaskRepeat="no-repeat",n.style.maskRepeat="no-repeat",n.style.webkitMaskPosition="0 0",n.style.maskPosition="0 0",n.dataset.category=e.dataset.category,n.dataset.angleKey=e.dataset.angleKey,n.dataset.shapeName=e.dataset.shapeName,n.dataset.textured="true",n.dataset.textureId=t.id,n.dataset.textureType="image",n}function lt(){const e=document.getElementById("bodiesTab"),t=document.getElementById("joinsTab"),o=document.getElementById("texturesTab"),r=document.getElementById("bodiesContent"),a=document.getElementById("joinsContent"),s=document.getElementById("texturesContent");e&&(e.addEventListener("click",()=>{if(M="bodies",e.className="flex-1 py-3 px-4 bg-white dark:bg-slate-800 border-r border-gray-300 dark:border-gray-700 font-medium text-gray-900 dark:text-gray-100",t.className="flex-1 py-3 px-4 bg-gray-200 dark:bg-slate-700 border-r border-gray-300 dark:border-gray-700 font-medium text-gray-700 dark:text-gray-200",o.className="flex-1 py-3 px-4 bg-gray-200 dark:bg-slate-700 font-medium text-gray-700 dark:text-gray-200",r.classList.remove("hidden"),a.classList.add("hidden"),s.classList.add("hidden"),C(),k){k=!1;const i=document.getElementById("cleanTextureBtn");i&&(i.classList.remove("border-blue-500","dark:border-blue-400","bg-blue-50","dark:bg-blue-900"),i.classList.add("border-gray-300","dark:border-gray-600"))}H()}),t.addEventListener("click",()=>{if(M="joins",t.className="flex-1 py-3 px-4 bg-white dark:bg-slate-800 border-r border-gray-300 dark:border-gray-700 font-medium text-gray-900 dark:text-gray-100",e.className="flex-1 py-3 px-4 bg-gray-200 dark:bg-slate-700 border-r border-gray-300 dark:border-gray-700 font-medium text-gray-700 dark:text-gray-200",o.className="flex-1 py-3 px-4 bg-gray-200 dark:bg-slate-700 font-medium text-gray-700 dark:text-gray-200",a.classList.remove("hidden"),r.classList.add("hidden"),s.classList.add("hidden"),C(),k){k=!1;const i=document.getElementById("cleanTextureBtn");i&&(i.classList.remove("border-blue-500","dark:border-blue-400","bg-blue-50","dark:bg-blue-900"),i.classList.add("border-gray-300","dark:border-gray-600"))}H()}),o.addEventListener("click",()=>{M="textures",o.className="flex-1 py-3 px-4 bg-white dark:bg-slate-800 font-medium text-gray-900 dark:text-gray-100",e.className="flex-1 py-3 px-4 bg-gray-200 dark:bg-slate-700 border-r border-gray-300 dark:border-gray-700 font-medium text-gray-700 dark:text-gray-200",t.className="flex-1 py-3 px-4 bg-gray-200 dark:bg-slate-700 border-r border-gray-300 dark:border-gray-700 font-medium text-gray-700 dark:text-gray-200",s.classList.remove("hidden"),r.classList.add("hidden"),a.classList.add("hidden"),C(),H()}))}function C(){w.serifs=!1,w.bodies=!1,w.joins=!1,$(),Ce();const e=document.querySelector(".builder-grids-wrapper");e&&(e.style.cursor="")}function dt(){if(k){k=!1;const e=document.getElementById("cleanTextureBtn");e&&(e.classList.remove("border-blue-500","dark:border-blue-400","bg-blue-50","dark:bg-blue-900"),e.classList.add("border-gray-300","dark:border-gray-600"))}window.clearMobileCleanMode&&window.clearMobileCleanMode()}function ne(e){e.preventDefault();const t=e.currentTarget;t.innerHTML=""}function I(){const e=document.getElementById("selectedShapeDisplay"),t=document.getElementById("selectedShapeInfo");if(p||E){e.classList.remove("hidden");let o="";p&&(o+=`Shape: ${p.category} > ${p.angleKey} > ${p.shape.shape_name}`),E&&(o&&(o+="<br>"),o+=`Texture: ${E.name}`),t.innerHTML=o}else e.classList.add("hidden")}function ct(){document.getElementById("clearSelection")&&document.getElementById("clearSelection").addEventListener("click",()=>{p=null,E=null,document.querySelectorAll(".shape-selected").forEach(t=>{t.classList.remove("shape-selected","bg-blue-200","border-blue-500")}),document.querySelectorAll("#texturesShapes button").forEach(t=>{t.classList.remove("border-blue-500","dark:border-blue-400","bg-blue-50","dark:bg-blue-900"),t.classList.add("border-gray-300","dark:border-gray-600")}),document.querySelectorAll('.mobile-shape-btn[data-category="textures"]').forEach(t=>{t.classList.remove("selected")}),I()})}function ut(){const e=document.getElementById("previewToggle");e&&e.addEventListener("change",r=>{N=r.target.checked,document.body.classList.toggle("preview-mode",N)});const t=document.getElementById("desktopPreviewBtn");t&&t.addEventListener("click",()=>{N=!N,document.body.classList.toggle("preview-mode",N);const r=t.querySelector("span"),a=document.getElementById("desktopPreviewIcon");N?(t.classList.add("bg-blue-100","dark:bg-blue-900"),t.classList.remove("hover:bg-gray-50","dark:hover:bg-slate-700"),t.classList.add("hover:bg-blue-200","dark:hover:bg-blue-800"),r&&(r.classList.remove("text-gray-700","dark:text-gray-200"),r.classList.add("text-blue-700","dark:text-blue-300")),a&&(a.src="/assets/icons/eye-slash.svg")):(t.classList.remove("bg-blue-100","dark:bg-blue-900"),t.classList.add("hover:bg-gray-50","dark:hover:bg-slate-700"),t.classList.remove("hover:bg-blue-200","dark:hover:bg-blue-800"),r&&(r.classList.remove("text-blue-700","dark:text-blue-300"),r.classList.add("text-gray-700","dark:text-gray-200")),a&&(a.src="/assets/icons/eye.svg"))});const o=document.getElementById("desktopClearGridsBtn");o&&o.addEventListener("click",()=>{window.clearAllGrids&&window.clearAllGrids()})}function H(){const e=document.getElementById("serifsGrid"),t=document.getElementById("joinsGrid");e&&(M==="bodies"?(e.style.zIndex="20",t.style.zIndex="10",e.classList.remove("grid-inactive"),e.classList.add("grid-active"),t.classList.remove("grid-active"),t.classList.add("grid-inactive")):M==="joins"&&(t.style.zIndex="20",e.style.zIndex="10",t.classList.remove("grid-inactive"),t.classList.add("grid-active"),e.classList.remove("grid-active"),e.classList.add("grid-inactive")))}document.addEventListener("DOMContentLoaded",()=>{window.SVGUtils&&window.SVGUtils.isReady&&window.SVGUtils.isReady()?D():(document.addEventListener("svgSystemReady",D),setTimeout(()=>{window.SVGUtils&&window.SVGUtils.isReady&&window.SVGUtils.isReady()&&(document.removeEventListener("svgSystemReady",D),D())},100))});window.initBuilderCore=De;const mt="TypographicTinkerer",bt=1,j="compositions";let L=null;async function Y(){return new Promise((e,t)=>{const o=indexedDB.open(mt,bt);o.onerror=()=>t(o.error),o.onsuccess=()=>{L=o.result,e(L)},o.onupgradeneeded=r=>{if(L=r.target.result,!L.objectStoreNames.contains(j)){const a=L.createObjectStore(j,{keyPath:"id",autoIncrement:!0});a.createIndex("name","name",{unique:!1}),a.createIndex("created","created",{unique:!1})}}})}async function gt(e){return L||await Y(),new Promise((t,o)=>{const a=L.transaction([j],"readwrite").objectStore(j),s={...e,saved:new Date().toISOString()},i=a.add(s);i.onsuccess=()=>{console.log("Composition saved to browser:",s.metadata.name),x(`"${s.metadata.name}" saved to browser`,"success"),t(i.result)},i.onerror=()=>{console.error("Failed to save composition:",i.error),x("Failed to save composition","error"),o(i.error)}})}async function ft(e){const t=JSON.stringify(e,null,2),o=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(o),a=document.createElement("a");a.href=r;const s=`${e.metadata.name.replace(/[^a-z0-9]/gi,"_")}.json`;a.download=s,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r),console.log("Composition downloaded:",e.metadata.name),x(`"${e.metadata.name}" downloaded`,"success"),(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&await pt(s)}async function pt(e){try{const t=await fetch("./archive/manifest.json");let o;t.ok?o=await t.json():o={files:[],lastUpdated:new Date().toISOString().split("T")[0]},o.files.includes(e)||(o.files.push(e),o.files.sort()),o.lastUpdated=new Date().toISOString().split("T")[0];const r=JSON.stringify(o,null,2),a=new Blob([r],{type:"application/json"}),s=URL.createObjectURL(a),i=document.createElement("a");i.href=s,i.download="manifest.json",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s),x("Updated manifest.json also downloaded","info")}catch(t){console.warn("Could not generate updated manifest:",t)}}async function R(){return L||await Y(),new Promise((e,t)=>{const a=L.transaction([j],"readonly").objectStore(j).getAll();a.onsuccess=()=>e(a.result),a.onerror=()=>t(a.error)})}async function ie(e){return L||await Y(),new Promise((t,o)=>{const s=L.transaction([j],"readwrite").objectStore(j).delete(e);s.onsuccess=()=>{console.log("Composition deleted from browser:",e),t()},s.onerror=()=>o(s.error)})}function Se(e){return{metadata:{name:e||"Untitled",created:new Date().toISOString(),version:"1.0"},grids:{serifs:fe("serifsGrid","serifs"),joins:fe("joinsGrid","joins")}}}function fe(e,t){const o=document.getElementById(e),r=[];console.log(`Extracting data from ${e}:`,o);for(let a=0;a<o.children.length;a++){const s=o.children[a],i=s.querySelectorAll("img"),n=s.querySelectorAll("svg"),l=s.querySelectorAll('[data-textured="true"]');i.forEach(d=>{if(d.src){const c=d.src,u=c.split("/"),m=u[u.length-1].replace(".svg",""),g=u[u.length-2],f=u[u.length-3];console.log(`Found img in cell ${a}:`,{srcPath:c,fileName:m,angleKey:g,category:f}),r.push({index:a,category:f,angleKey:g,shapeName:m,imagePath:`./assets/shapes/${f}/${g}/${m}.svg`})}}),n.forEach(d=>{if(d.dataset.textured==="true")return;console.log(`Found svg in cell ${a}:`,d);const c=d.getAttribute("data-category"),u=d.getAttribute("data-angle-key"),m=d.getAttribute("data-shape-name");c&&u&&m&&r.push({index:a,category:c,angleKey:u,shapeName:m,imagePath:`./assets/shapes/${c}/${u}/${m}.svg`})}),l.forEach(d=>{console.log(`Found textured element in cell ${a}:`,d);const c=d.dataset.category,u=d.dataset.angleKey,m=d.dataset.shapeName,g=d.dataset.textureId,f=d.dataset.textureType,h=d.dataset.textureColor;if(c&&u&&m&&g){const b={id:g,applied:!0};f==="color"&&h&&(b.type="color",b.color=h),r.push({index:a,category:c,angleKey:u,shapeName:m,imagePath:`./assets/shapes/${c}/${u}/${m}.svg`,texture:b})}})}return console.log(`Extracted ${r.length} shapes from ${e}`),{gridType:t,gridSize:t==="serifs"?5:4,shapes:r}}function ht(){const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=yt,e.click()}function yt(e){const t=e.target.files[0];if(!t)return;const o=new FileReader;o.onload=function(r){var a;try{const s=JSON.parse(r.target.result);le(s),console.log("Composition loaded from file:",((a=s.metadata)==null?void 0:a.name)||"Unknown")}catch(s){alert("Error loading file: Invalid JSON format"),console.error("Load error:",s)}},o.readAsText(t)}function le(e){var o,r,a;console.log("Loading composition:",e),Be(!0),(o=e.grids)!=null&&o.serifs&&(console.log("Loading serifs grid with",e.grids.serifs.shapes.length,"shapes"),pe("serifsGrid",e.grids.serifs)),(r=e.grids)!=null&&r.joins&&(console.log("Loading joins grid with",e.grids.joins.shapes.length,"shapes"),pe("joinsGrid",e.grids.joins));const t=((a=e.metadata)==null?void 0:a.name)||"Composition";x(`"${t}" loaded successfully`,"success")}function pe(e,t){const o=document.getElementById(e),r={};t.shapes.forEach(a=>{r[a.index]||(r[a.index]=[]),r[a.index].push(a)}),Object.keys(r).forEach(a=>{const s=o.children[a];if(!s)return;r[a].forEach((n,l)=>{var c,u,m;const d={category:n.category,angleKey:n.angleKey,shape:{shape_name:n.shapeName},imagePath:n.imagePath};if((m=(u=(c=window.rulesData)==null?void 0:c.shapes)==null?void 0:u[n.category])!=null&&m[n.angleKey]){const g=window.rulesData.shapes[n.category][n.angleKey].find(f=>f.shape_name===n.shapeName);if(g)if(d.shape=g,window.placeShapeInCell){const f=l>0;if(window.placeShapeInCell(s,d,f),n.texture&&n.texture.applied&&n.texture.id)if(n.texture.type==="color"&&n.texture.color){const h={type:"color",id:n.texture.id,name:n.texture.id==="black"?"Black":n.texture.id==="white"?"White":"Custom Color",color:n.texture.color};if(window.applyTextureToShape){const b=s.querySelector(`svg[data-shape-name="${n.shapeName}"]`);if(b){const v=window.applyTextureToShape(b,h);v&&v!==b&&(b.parentNode.replaceChild(v,b),console.log(`Applied color "${h.color}" to shape "${n.shapeName}"`))}else console.warn("Could not find placed SVG to apply color")}}else if(window.texturesData&&window.applyTextureToShape){const h=window.texturesData.textures.find(b=>b.id===n.texture.id);if(h){const b=s.querySelector(`svg[data-shape-name="${n.shapeName}"]`);if(b){const v=window.applyTextureToShape(b,h);v&&v!==b&&(b.parentNode.replaceChild(v,b),console.log(`Applied texture "${h.name}" to shape "${n.shapeName}"`))}else console.warn("Could not find placed SVG to apply texture")}else console.warn(`Texture not found: ${n.texture.id}`)}else console.warn("Texture system not available")}else console.warn("placeShapeInCell function not available");else console.warn("Shape not found in rulesData:",n.shapeName)}else console.warn("Category/angleKey not found in rulesData:",n.category,n.angleKey)})})}function Le(e=!0){const t=document.getElementById("serifsGrid"),o=document.getElementById("joinsGrid");for(let r=0;r<t.children.length;r++)t.children[r].innerHTML="";for(let r=0;r<o.children.length;r++)o.children[r].innerHTML="";window.clearCleanMode&&window.clearCleanMode(),e&&x("All grids cleared","success")}function Be(e=!1){e?Le(!1):wt()}function wt(){const e=document.createElement("div");e.className="fixed inset-0 bg-black/50 dark:bg-black/60 z-50 flex items-center justify-center";const t=document.createElement("div");t.className="bg-white dark:bg-slate-800 border border-gray-300 dark:border-gray-700 rounded-lg shadow-xl max-w-sm w-full mx-4";const o=document.createElement("div");o.className="px-6 py-4 border-b border-gray-200 dark:border-gray-700",o.innerHTML=`
    <h3 class="text-lg font-medium text-red-600 dark:text-red-400">Clear All Grids</h3>
  `;const r=document.createElement("div");r.className="px-6 py-4",r.innerHTML=`
    <p class="text-gray-700 dark:text-gray-200">Are you sure you want to clear all shapes from the grids?</p>
    <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">This action cannot be undone.</p>
  `;const a=document.createElement("div");a.className="px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-3";const s=document.createElement("button");s.className="px-4 py-2 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-800 rounded-lg transition-colors",s.textContent="Cancel",s.onclick=()=>document.body.removeChild(e);const i=document.createElement("button");i.className="px-4 py-2 bg-red-600 hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600 text-white rounded-lg transition-colors",i.textContent="Clear All",i.onclick=()=>{Le(!0),document.body.removeChild(e)},a.appendChild(s),a.appendChild(i),t.appendChild(o),t.appendChild(r),t.appendChild(a),e.appendChild(t),document.body.appendChild(e),e.onclick=l=>{l.target===e&&document.body.removeChild(e)};const n=l=>{l.key==="Escape"&&(document.body.removeChild(e),document.removeEventListener("keydown",n))};document.addEventListener("keydown",n)}function x(e,t="info"){const o=document.createElement("div");o.className=`fixed top-4 left-1/2 transform -translate-x-1/2 z-50 px-4 py-2 rounded-lg shadow-lg text-white text-sm font-medium ${t==="success"?"bg-green-500 dark:bg-green-600":t==="error"?"bg-red-500 dark:bg-red-600":"bg-blue-500 dark:bg-blue-600"}`,o.textContent=e,document.body.appendChild(o),setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},3e3)}function Te(e,t,o){const r=document.createElement("div");r.className="fixed inset-0 bg-black/50 dark:bg-black/60 z-50 flex items-center justify-center";const a=document.createElement("div");a.className="bg-white dark:bg-slate-800 border border-gray-300 dark:border-gray-700 rounded-lg shadow-xl max-w-sm w-full mx-4";const s=document.createElement("div");s.className="px-6 py-4 border-b border-gray-200 dark:border-gray-700",s.innerHTML=`
    <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">${e}</h3>
  `;const i=document.createElement("div");i.className="px-6 py-4";const n=document.createElement("input");n.type="text",n.placeholder=t,n.className="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",n.value="",i.appendChild(n);const l=document.createElement("div");l.className="px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-3";const d=document.createElement("button");d.className="px-4 py-2 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-800 rounded-lg transition-colors",d.textContent="Cancel",d.onclick=()=>document.body.removeChild(r);const c=document.createElement("button");c.className="px-4 py-2 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white rounded-lg transition-colors",c.textContent="Save";const u=()=>{const m=n.value.trim();m?(document.body.removeChild(r),o(m)):(n.focus(),n.className=n.className+" border-red-500",setTimeout(()=>{n.className=n.className.replace(" border-red-500","")},2e3))};c.onclick=u,n.onkeydown=m=>{m.key==="Enter"?u():m.key==="Escape"&&document.body.removeChild(r)},l.appendChild(d),l.appendChild(c),a.appendChild(s),a.appendChild(i),a.appendChild(l),r.appendChild(a),document.body.appendChild(r),setTimeout(()=>n.focus(),100),r.onclick=m=>{m.target===r&&document.body.removeChild(r)}}async function vt(){Te("Save Composition","Enter composition name...",async e=>{const t=Se(e);try{await gt(t)}catch(o){console.error("Save failed:",o),x("Failed to save composition","error")}})}async function xt(){Te("Save to Computer","Enter composition name...",async e=>{const t=Se(e);await ft(t)})}async function Ne(){try{const e=await R();if(e.length===0){x("No saved compositions found in browser","info");return}Ct(e)}catch(e){console.error("Failed to load compositions:",e),x("Failed to load compositions from browser","error")}}function kt(e,t,o){const r=document.createElement("div");r.className="fixed inset-0 bg-black/50 dark:bg-black/60 z-50 flex items-center justify-center";const a=document.createElement("div");a.className="bg-white dark:bg-slate-800 border border-gray-300 dark:border-gray-700 rounded-lg shadow-xl max-w-sm w-full mx-4";const s=document.createElement("div");s.className="px-6 py-4 border-b border-gray-200 dark:border-gray-700",s.innerHTML=`
    <h3 class="text-lg font-medium text-red-600 dark:text-red-400">Delete Composition</h3>
  `;const i=document.createElement("div");i.className="px-6 py-4",i.innerHTML=`
    <p class="text-gray-700 dark:text-gray-200">Are you sure you want to delete <strong>"${e.metadata.name}"</strong>?</p>
    <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">This action cannot be undone.</p>
  `;const n=document.createElement("div");n.className="px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-3";const l=document.createElement("button");l.className="px-4 py-2 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-800 rounded-lg transition-colors",l.textContent="Cancel",l.onclick=()=>document.body.removeChild(r);const d=document.createElement("button");d.className="px-4 py-2 bg-red-600 hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600 text-white rounded-lg transition-colors",d.textContent="Delete",d.onclick=async()=>{try{await ie(e.id),x(`"${e.metadata.name}" deleted`,"success"),document.body.removeChild(r),o()}catch(u){console.error("Delete failed:",u),x("Failed to delete composition","error")}},n.appendChild(l),n.appendChild(d),a.appendChild(s),a.appendChild(i),a.appendChild(n),r.appendChild(a),document.body.appendChild(r),r.onclick=u=>{u.target===r&&document.body.removeChild(r)};const c=u=>{u.key==="Escape"&&(document.body.removeChild(r),document.removeEventListener("keydown",c))};document.addEventListener("keydown",c)}function Ct(e){const t=document.createElement("div");t.className="fixed inset-0 bg-black/50 dark:bg-black/60 z-50 flex items-center justify-center";const o=document.createElement("div");o.className="bg-white dark:bg-slate-800 border border-gray-300 dark:border-gray-700 rounded-lg shadow-xl max-w-md w-full mx-4 max-h-108 overflow-hidden";const r=document.createElement("div");r.className="px-6 py-4 border-b border-gray-200 dark:border-gray-700",r.innerHTML=`
    <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">Load Composition</h3>
    <p class="text-sm text-gray-500 dark:text-gray-400">Choose a composition to load</p>
  `;const a=document.createElement("div");a.className="max-h-64 overflow-y-auto px-6 py-4",e.forEach((n,l)=>{const d=document.createElement("div");d.className="border border-gray-200 dark:border-gray-700 rounded mb-2 p-3 hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors";const c=new Date(n.saved||n.metadata.created).toLocaleDateString(),u=document.createElement("div");u.className="flex items-center justify-between";const m=document.createElement("button");m.className="flex-1 text-left",m.innerHTML=`
      <div class="font-medium text-gray-900 dark:text-gray-100">${n.metadata.name}</div>
      <div class="text-sm text-gray-500 dark:text-gray-400">Saved: ${c}</div>
    `,m.onclick=()=>{le(n),document.body.removeChild(t)};const g=document.createElement("button");g.className="ml-3 px-2 py-1 text-red-600 hover:bg-red-100 dark:hover:bg-slate-800 rounded transition-colors text-sm",g.innerHTML='<img src="/assets/icons/trash.svg" alt="Delete" class="w-6 h-6 inline-block dark:invert">',g.title="Delete composition",g.onclick=f=>{f.stopPropagation(),kt(n,t,()=>{document.body.removeChild(t),Ne()})},u.appendChild(m),u.appendChild(g),d.appendChild(u),a.appendChild(d)});const s=document.createElement("div");s.className="px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex justify-end";const i=document.createElement("button");i.className="px-4 py-2 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-800 rounded transition-colors",i.textContent="Cancel",i.onclick=()=>document.body.removeChild(t),s.appendChild(i),o.appendChild(r),o.appendChild(a),o.appendChild(s),t.appendChild(o),document.body.appendChild(t),t.onclick=n=>{n.target===t&&document.body.removeChild(t)}}async function Et(){try{if((await R()).length===0){x("No saved compositions found in browser","info");return}const t=document.createElement("div");t.className="fixed inset-0 bg-black/50 dark:bg-black/60 z-50 flex items-center justify-center";const o=document.createElement("div");o.className="bg-white dark:bg-slate-800 border border-gray-300 dark:border-gray-700 rounded-lg shadow-xl max-w-md w-full mx-4 max-h-108 overflow-hidden";const r=document.createElement("div");r.className="px-6 py-4 border-b border-gray-200 dark:border-gray-700",r.innerHTML=`
      <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">Manage Saved Compositions</h3>
      <p class="text-sm text-gray-500 dark:text-gray-400">Load or delete your saved compositions</p>
    `;const a=document.createElement("div");a.className="max-h-64 overflow-y-auto px-6 py-4";const s=async()=>{const l=await R();if(a.innerHTML="",l.length===0){a.innerHTML='<p class="text-gray-500 dark:text-gray-400 text-center py-8">No compositions saved</p>';return}l.forEach(d=>{const c=document.createElement("div");c.className="border border-gray-200 dark:border-gray-700 rounded mb-2 p-3 hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors";const u=new Date(d.saved||d.metadata.created).toLocaleDateString(),m=document.createElement("div");m.className="flex items-center justify-between";const g=document.createElement("div");g.className="flex-1",g.innerHTML=`
          <div class="font-medium text-gray-900 dark:text-gray-100">${d.metadata.name}</div>
          <div class="text-sm text-gray-500 dark:text-gray-400">Saved: ${u}</div>
        `;const f=document.createElement("div");f.className="flex gap-2 ml-3";const h=document.createElement("button");h.className="px-3 py-1 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white rounded text-sm transition-colors",h.textContent="Load",h.onclick=()=>{le(d),document.body.removeChild(t)};const b=document.createElement("button");b.className="px-3 py-1 bg-red-600 hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600 text-white rounded text-sm transition-colors",b.textContent="Delete",b.onclick=async()=>{if(confirm(`Delete "${d.metadata.name}"?`))try{await ie(d.id),x(`"${d.metadata.name}" deleted`,"success"),s()}catch(v){console.error("Delete failed:",v),x("Failed to delete composition","error")}},f.appendChild(h),f.appendChild(b),m.appendChild(g),m.appendChild(f),c.appendChild(m),a.appendChild(c)})};await s();const i=document.createElement("div");i.className="px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex justify-end";const n=document.createElement("button");n.className="px-4 py-2 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-800 rounded transition-colors",n.textContent="Close",n.onclick=()=>document.body.removeChild(t),i.appendChild(n),o.appendChild(r),o.appendChild(a),o.appendChild(i),t.appendChild(o),document.body.appendChild(t),t.onclick=l=>{l.target===t&&document.body.removeChild(t)}}catch(e){console.error("Failed to load compositions:",e),x("Failed to load compositions from browser","error")}}function St(){ht()}document.addEventListener("DOMContentLoaded",()=>{Y().catch(console.error),window.saveComposition=vt,window.saveCompositionToComputer=xt,window.loadComposition=St,window.loadFromBrowser=Ne,window.manageCompositions=Et,window.clearAllGrids=Be,window.getAllCompositions=R,window.deleteFromBrowser=ie,window.showNotification=x,console.log("Storage functionality initialized")});console.log("Storage module loaded");
