import{i as E,a as C}from"./components-BnrkmWez.js";import"./svg-ckjYZtu2.js";import"./storage-Vn0rREE0.js";import{i as k,s as j,a as N,b as S,u,c as B,g as L}from"./mobile_controls-DF0OqE54.js";async function f(){console.log("Initializing archive...");const e=document.getElementById("loading");e.innerHTML=`
    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
    <p class="mt-4 text-gray-600 dark:text-gray-300">Loading builder core...</p>
  `;try{if(window.initBuilderCore)await window.initBuilderCore();else throw new Error("Builder core not available");e.innerHTML=`
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
      <p class="mt-4 text-gray-600 dark:text-gray-300">Loading archived forms...</p>
    `,await x()}catch(n){console.error("Failed to initialize archive:",n),e.innerHTML=`
      <div class="inline-block w-12 h-12 mb-4">
        <img src="assets/icons/warning.svg" alt="Warning" class="w-full h-full text-red-500">
      </div>
      <p class="text-gray-600 dark:text-gray-300 mb-4">Failed to initialize archive</p>
      <p class="text-gray-500 dark:text-gray-400 text-sm">Error: ${n.message}</p>
    `}}async function x(){const e=document.getElementById("loading");document.getElementById("error");const n=document.getElementById("archive-grid"),r=document.getElementById("archive-forms");try{const a=[];let o;try{const i=await fetch("./archive/manifest.json");if(i.ok)o=(await i.json()).files;else throw new Error("Manifest not found")}catch(i){console.warn("Could not load manifest, falling back to hardcoded list:",i),o=["cam.json","cam_v2.json","pyraflare.json","apek.json","phoenetic/A.json","phoenetic/B.json","phoenetic/C.json"]}for(const i of o)try{console.log(`Attempting to load: ./archive/${i}`);const t=await fetch(`./archive/${i}`);if(t.ok){const s=await t.json();s.filename=i,s.source="archive",a.push(s)}else console.warn(`[FAILED] Failed to load ${i}: ${t.status} ${t.statusText}`)}catch(t){console.warn(`[ERROR] Error loading ${i}:`,t)}console.log(`Total compositions loaded from archive: ${a.length}`);try{window.getAllCompositions?(await window.getAllCompositions()).forEach((t,s)=>{t.source="browser",t.filename=`browser-${t.id||s}`,a.push(t)}):console.warn("Browser storage not available (getAllCompositions function not found)")}catch(i){console.warn("Could not load compositions from browser storage:",i)}if(console.log(`Total compositions loaded: ${a.length} (archive + browser)`),a.length===0)throw new Error("No compositions could be loaded");e.classList.add("hidden"),n.classList.remove("hidden"),r.innerHTML="",a.forEach((i,t)=>{var l;console.log(`Creating form element ${t+1}/${a.length}:`,(l=i.metadata)==null?void 0:l.name);const s=$(i);r.appendChild(s)}),k("5xl","5xl"),F(),j(),N(".archive-grids-wrapper"),S(".archive-grid-cell",u),B(L(),".archive-grids-wrapper")}catch(a){console.error("Failed to load archived forms:",a),e.classList.add("hidden"),T()}}function $(e){var h,p,g,c;const n=document.createElement("div");n.className="bg-white dark:bg-slate-800 rounded-lg shadow-md border border-gray-200 dark:border-slate-700 p-6";const r=document.createElement("div");r.className="mb-6";const a=document.createElement("div");a.className="flex items-center gap-3 mb-2";const o=document.createElement("h2");if(o.className="text-xl font-bold text-gray-900 dark:text-gray-100",o.textContent=((h=e.metadata)==null?void 0:h.name)||"Untitled",a.appendChild(o),e.source==="browser"){const m=document.createElement("span");m.className="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",m.textContent="Made by you!",a.appendChild(m)}const i=document.createElement("div");if(i.className="text-sm text-gray-600 dark:text-gray-400 flex flex-wrap gap-4",(p=e.metadata)!=null&&p.created){const m=new Date(e.metadata.created),y=document.createElement("span");y.textContent=`Created: ${m.toLocaleDateString()}`,i.appendChild(y)}if(e.source==="archive"){const m=document.createElement("span");m.textContent=`File: ${e.filename}`,i.appendChild(m)}r.appendChild(a),r.appendChild(i),n.appendChild(r);const t=document.createElement("div");t.className="relative bg-gray-50 dark:bg-slate-900 rounded-lg p-4 flex items-center justify-center max-h-[300px] md:max-h-none overflow-hidden",t.style.minHeight="400px";const s=document.createElement("div");s.className="relative archive-grids-wrapper",s.style.transform="scale(0.3)";const l=document.createElement("div");l.className="grid grid-cols-5 gap-0 z-10",l.style.width="500px",l.style.height="500px",l.id=`serifs-${e.filename.replace(".json","")}`;const d=document.createElement("div");return d.className="absolute grid grid-cols-4 gap-0 z-0",d.style.width="400px",d.style.height="400px",d.style.top="50px",d.style.left="50px",d.id=`joins-${e.filename.replace(".json","")}`,v(l,25),v(d,16),s.appendChild(l),s.appendChild(d),t.appendChild(s),n.appendChild(t),(g=e.grids)!=null&&g.serifs&&b(l,e.grids.serifs),(c=e.grids)!=null&&c.joins&&b(d,e.grids.joins),n}function v(e,n){for(let r=0;r<n;r++){const a=document.createElement("div");a.className="w-[100px] h-[100px] relative archive-grid-cell",a.dataset.index=r,e.appendChild(a)}}function b(e,n){const r={};n.shapes.forEach(a=>{r[a.index]||(r[a.index]=[]),r[a.index].push(a)}),Object.keys(r).forEach(a=>{const o=e.children[a];if(!o)return;r[a].forEach((t,s)=>{var d,h,p;const l={category:t.category,angleKey:t.angleKey,shape:{shape_name:t.shapeName},imagePath:t.imagePath};if((p=(h=(d=window.rulesData)==null?void 0:d.shapes)==null?void 0:h[t.category])!=null&&p[t.angleKey]){const g=window.rulesData.shapes[t.category][t.angleKey].find(c=>c.shape_name===t.shapeName);if(g){l.shape=g;const c=s>0;A(o,l,c)}else{console.warn("Shape not found in rulesData:",t.shapeName);const c=s>0;w(o,t.shapeName,c)}}else{console.warn("Category/angleKey not found in rulesData:",t.category,t.angleKey);const g=s>0;w(o,t.shapeName,g)}})})}function A(e,n,r=!1){r||(e.innerHTML="");const a="absolute";let o=null;if(window.SVGUtils&&window.SVGUtils.createSVGElement&&(o=window.SVGUtils.createSVGElement(n.category,n.angleKey,n.shape.shape_name,a)),!o){console.warn("Could not create SVG for shape:",n),w(e,n.shape.shape_name,r);return}o.setAttribute("alt",n.shape.shape_name),window.applyPositioning?window.applyPositioning(o,n):(o.style.width="100%",o.style.height="100%",o.style.top="0",o.style.left="0"),e.appendChild(o)}function w(e,n,r=!1){r||(e.innerHTML="");const a=document.createElement("div");a.textContent=n.substring(0,4),a.className="absolute inset-0 flex items-center justify-center text-xs font-mono text-gray-600 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded",e.appendChild(a)}function T(){const e=document.getElementById("loading"),n=document.getElementById("error");e.classList.add("hidden"),n.classList.remove("hidden")}function F(){const e=document.getElementById("bordersToggle");if(!e){console.warn("Borders toggle not found");return}u(e.checked),e.addEventListener("change",n=>{u(n.target.checked)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",f):f();window.initArchive=f;window.loadArchivedForms=x;E();C();
