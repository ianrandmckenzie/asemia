import{i as E,a as C}from"./components-GurPHsns.js";import"./svg-ckjYZtu2.js";import"./builder-eHfHUSQk.js";import"./storage-JQpETU5t.js";import{i as k,s as S,a as j,b as L,u as p,c as B,g as N}from"./mobile_controls-DF0OqE54.js";async function u(){console.log("Initializing archive...");const e=document.getElementById("loading");e.innerHTML=`
    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
    <p class="mt-4 text-gray-600 dark:text-gray-300">Loading builder core...</p>
  `;try{if(window.initBuilderCore)await window.initBuilderCore();else throw new Error("Builder core not available");e.innerHTML=`
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
      <p class="mt-4 text-gray-600 dark:text-gray-300">Loading archived forms...</p>
    `,await x()}catch(a){console.error("Failed to initialize archive:",a),e.innerHTML=`
      <div class="text-red-500 text-xl mb-4">‚ö†Ô∏è</div>
      <p class="text-gray-600 dark:text-gray-300 mb-4">Failed to initialize archive</p>
      <p class="text-gray-500 dark:text-gray-400 text-sm">Error: ${a.message}</p>
    `}}async function x(){var r;const e=document.getElementById("loading");document.getElementById("error");const a=document.getElementById("archive-grid"),i=document.getElementById("archive-forms");try{let n;try{const t=await fetch("./archive/manifest.json");if(t.ok)n=(await t.json()).files,console.log(`üìã Loaded manifest with ${n.length} files`);else throw new Error("Manifest not found")}catch(t){console.warn("Could not load manifest, falling back to hardcoded list:",t),n=["cam.json","cam_v2.json","pyraflare.json","apek.json","phoenetic/A.json","phoenetic/B.json","phoenetic/C.json"]}const d=[];for(const t of n)try{console.log(`Attempting to load: ./archive/${t}`);const o=await fetch(`./archive/${t}`);if(o.ok){const s=await o.json();s.filename=t,d.push(s),console.log(`‚úÖ Loaded ${t}:`,((r=s.metadata)==null?void 0:r.name)||"Unknown")}else console.warn(`‚ùå Failed to load ${t}: ${o.status} ${o.statusText}`)}catch(o){console.warn(`‚ùå Error loading ${t}:`,o)}if(console.log(`Total compositions loaded: ${d.length}`),d.length===0)throw new Error("No compositions could be loaded");e.classList.add("hidden"),a.classList.remove("hidden"),i.innerHTML="",d.forEach((t,o)=>{var l;console.log(`Creating form element ${o+1}/${d.length}:`,(l=t.metadata)==null?void 0:l.name);const s=$(t);i.appendChild(s)}),console.log(`üéâ Successfully loaded ${d.length} archived forms`),k("5xl","5xl"),z(),S(),j(".archive-grids-wrapper"),L(".archive-grid-cell",p),B(N(),".archive-grids-wrapper")}catch(n){console.error("Failed to load archived forms:",n),e.classList.add("hidden"),F()}}function $(e){var g,h,m,c;const a=document.createElement("div");a.className="bg-white dark:bg-slate-800 rounded-lg shadow-md border border-gray-200 dark:border-slate-700 p-6";const i=document.createElement("div");i.className="mb-6";const r=document.createElement("h2");r.className="text-xl font-bold text-gray-900 dark:text-gray-100 mb-2",r.textContent=((g=e.metadata)==null?void 0:g.name)||"Untitled";const n=document.createElement("div");if(n.className="text-sm text-gray-600 dark:text-gray-400 flex flex-wrap gap-4",(h=e.metadata)!=null&&h.created){const b=new Date(e.metadata.created),y=document.createElement("span");y.textContent=`Created: ${b.toLocaleDateString()}`,n.appendChild(y)}const d=document.createElement("span");d.textContent=`File: ${e.filename}`,n.appendChild(d),i.appendChild(r),i.appendChild(n),a.appendChild(i);const t=document.createElement("div");t.className="relative bg-gray-50 dark:bg-slate-900 rounded-lg p-4 flex items-center justify-center max-h-[300px] md:max-h-none overflow-hidden",t.style.minHeight="400px";const o=document.createElement("div");o.className="relative archive-grids-wrapper",o.style.transform="scale(0.3)";const s=document.createElement("div");s.className="grid grid-cols-5 gap-0 z-10",s.style.width="500px",s.style.height="500px",s.id=`serifs-${e.filename.replace(".json","")}`;const l=document.createElement("div");return l.className="absolute grid grid-cols-4 gap-0 z-0",l.style.width="400px",l.style.height="400px",l.style.top="50px",l.style.left="50px",l.id=`joins-${e.filename.replace(".json","")}`,w(s,25),w(l,16),o.appendChild(s),o.appendChild(l),t.appendChild(o),a.appendChild(t),(m=e.grids)!=null&&m.serifs&&v(s,e.grids.serifs),(c=e.grids)!=null&&c.joins&&v(l,e.grids.joins),a}function w(e,a){for(let i=0;i<a;i++){const r=document.createElement("div");r.className="w-[100px] h-[100px] relative archive-grid-cell",r.dataset.index=i,e.appendChild(r)}}function v(e,a){const i={};a.shapes.forEach(r=>{i[r.index]||(i[r.index]=[]),i[r.index].push(r)}),Object.keys(i).forEach(r=>{const n=e.children[r];if(!n)return;i[r].forEach((t,o)=>{var l,g,h;const s={category:t.category,angleKey:t.angleKey,shape:{shape_name:t.shapeName},imagePath:t.imagePath};if((h=(g=(l=window.rulesData)==null?void 0:l.shapes)==null?void 0:g[t.category])!=null&&h[t.angleKey]){const m=window.rulesData.shapes[t.category][t.angleKey].find(c=>c.shape_name===t.shapeName);if(m){s.shape=m;const c=o>0;T(n,s,c)}else{console.warn("Shape not found in rulesData:",t.shapeName);const c=o>0;f(n,t.shapeName,c)}}else{console.warn("Category/angleKey not found in rulesData:",t.category,t.angleKey);const m=o>0;f(n,t.shapeName,m)}})})}function T(e,a,i=!1){i||(e.innerHTML="");const r="absolute";let n=null;if(window.SVGUtils&&window.SVGUtils.createSVGElement&&(n=window.SVGUtils.createSVGElement(a.category,a.angleKey,a.shape.shape_name,r)),!n){console.warn("Could not create SVG for shape:",a),f(e,a.shape.shape_name,i);return}n.setAttribute("alt",a.shape.shape_name),window.applyPositioning?window.applyPositioning(n,a):(n.style.width="100%",n.style.height="100%",n.style.top="0",n.style.left="0"),e.appendChild(n)}function f(e,a,i=!1){i||(e.innerHTML="");const r=document.createElement("div");r.textContent=a.substring(0,4),r.className="absolute inset-0 flex items-center justify-center text-xs font-mono text-gray-600 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded",e.appendChild(r)}function F(){const e=document.getElementById("loading"),a=document.getElementById("error");e.classList.add("hidden"),a.classList.remove("hidden")}function z(){const e=document.getElementById("bordersToggle");if(!e){console.warn("Borders toggle not found");return}p(e.checked),e.addEventListener("change",a=>{p(a.target.checked)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",u):u();window.initArchive=u;window.loadArchivedForms=x;E();C();
