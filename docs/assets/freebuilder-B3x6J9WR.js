import{i as ge}from"./components-pPIV5Z_R.js";import"./svg-ckjYZtu2.js";import"./storage-DA4SciAX.js";async function ue(e){return new Promise((t,s)=>{const n=new Image;n.crossOrigin="anonymous",n.onload=()=>{const c=document.createElement("canvas");c.width=n.width,c.height=n.height,c.getContext("2d").drawImage(n,0,0);try{const o=c.toDataURL("image/png");t(o)}catch(o){console.warn("Failed to convert image to data URL:",o),t(e)}},n.onerror=()=>{console.warn("Failed to load image:",e),t(e)},n.src=e})}async function te(){const e=document.getElementById("serifsGrid"),t=document.getElementById("joinsGrid");if(!e||!t)throw new Error("Grid not found. Please ensure the builder is loaded.");const s=e.getBoundingClientRect(),n=t.getBoundingClientRect(),c=Math.min(s.left,n.left),i=Math.min(s.top,n.top),o=Math.max(s.right,n.right),l=Math.max(s.bottom,n.bottom),m=o-c,w=l-i,r="http://www.w3.org/2000/svg",d=document.createElementNS(r,"svg");d.setAttribute("xmlns",r),d.setAttribute("viewBox",`0 0 ${m} ${w}`),d.setAttribute("width",m),d.setAttribute("height",w);const a=document.createElementNS(r,"g"),P=[{element:e,rect:s,name:"serifs"},{element:t,rect:n,name:"joins"}];for(const S of P){const b=S.element.querySelectorAll(".grid-cell");for(const f of b){const I=f.querySelectorAll("svg"),Z=f.querySelectorAll('[data-textured="true"]');for(const E of I){const v=E.cloneNode(!0),p=f.getBoundingClientRect(),C=p.left-c,h=p.top-i,y=window.getComputedStyle(E),M=parseFloat(y.width)||p.width,J=parseFloat(y.height)||p.height,H=y.position,B=y.top,L=y.left,R=y.right,U=y.bottom,$=y.transform;let G=C,Y=h;if(H==="absolute"){if(L!=="auto"&&L!==""){const u=parseFloat(L);G+=u}else if(R!=="auto"&&R!==""){const u=parseFloat(R);G+=p.width-M-u}if(B!=="auto"&&B!==""){const u=parseFloat(B);Y+=u}else if(U!=="auto"&&U!==""){const u=parseFloat(U);Y+=p.height-J-u}}const A=document.createElementNS(r,"g");let x=`translate(${G}, ${Y})`;if($&&$!=="none"){const u=$.match(/matrix\(([^)]+)\)/);if(u){const _=u[1].split(",").map(F=>parseFloat(F.trim()));if(_.length===6){const F=_[4],V=_[5];x+=` translate(${F}, ${V})`}}}A.setAttribute("transform",x);const N=v.innerHTML,D=v.getAttribute("viewBox");if(D){const u=document.createElementNS(r,"svg");u.setAttribute("viewBox",D),u.setAttribute("width",M),u.setAttribute("height",J),u.innerHTML=N,A.appendChild(u)}else{const u=document.createElementNS(r,"g");u.innerHTML=N,A.appendChild(u)}a.appendChild(A)}for(const E of Z){const v=f.getBoundingClientRect(),p=v.left-c,C=v.top-i,h=window.getComputedStyle(E),y=parseFloat(h.width)||v.width,M=parseFloat(h.height)||v.height,J=h.position,H=h.top,B=h.left,L=h.right,R=h.bottom,U=h.transform;let $=p,G=C;if(J==="absolute"){if(B!=="auto"&&B!==""){const x=parseFloat(B);$+=x}else if(L!=="auto"&&L!==""){const x=parseFloat(L);$+=v.width-y-x}if(H!=="auto"&&H!==""){const x=parseFloat(H);G+=x}else if(R!=="auto"&&R!==""){const x=parseFloat(R);G+=v.height-M-x}}const Y=E.dataset.textureId,A=h.webkitMaskImage||h.maskImage;if(A&&A.includes("data:image/svg+xml;base64,")){const x=A.match(/data:image\/svg\+xml;base64,([^)'"]+)/);if(x)try{const N=x[1],D=decodeURIComponent(escape(atob(N))),F=new DOMParser().parseFromString(D,"image/svg+xml").querySelector("svg");if(F){const V=document.createElementNS(r,"g");let ne=`translate(${$}, ${G})`;if(U&&U!=="none"){const g=U.match(/matrix\(([^)]+)\)/);if(g){const T=g[1].split(",").map(X=>parseFloat(X.trim()));if(T.length===6){const X=T[4],de=T[5];ne+=` translate(${X}, ${de})`}}}V.setAttribute("transform",ne);const ie=document.createElementNS(r,"defs"),z=document.createElementNS(r,"pattern"),K=`texture-${Y}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;z.setAttribute("id",K),z.setAttribute("patternUnits","userSpaceOnUse"),z.setAttribute("width",y),z.setAttribute("height",M);const re=h.backgroundImage.match(/url\(['"]?([^'"]+)['"]?\)/);if(re){let g=re[1];g.startsWith("/")?g=window.location.origin+g:!g.startsWith("http")&&!g.startsWith("data:")&&(g=new URL(g,window.location.href).href);try{g=await ue(g)}catch(X){console.warn("Failed to convert texture to data URL, using absolute URL:",X)}const T=document.createElementNS(r,"image");T.setAttribute("href",g),T.setAttribute("width",y),T.setAttribute("height",M),T.setAttribute("preserveAspectRatio","xMidYMid slice"),z.appendChild(T)}ie.appendChild(z),V.appendChild(ie);const se=F.getAttribute("viewBox"),j=document.createElementNS(r,"svg");j.setAttribute("width",y),j.setAttribute("height",M),se&&j.setAttribute("viewBox",se);const W=F.cloneNode(!0),le=W.querySelectorAll("path, polygon, circle, ellipse, rect, line, polyline");le.forEach(g=>{(!g.hasAttribute("fill")||g.getAttribute("fill")!=="none"&&g.getAttribute("fill")!=="")&&g.setAttribute("fill",`url(#${K})`),g.hasAttribute("stroke")&&g.getAttribute("stroke")!=="none"&&g.getAttribute("stroke")!==""&&g.setAttribute("stroke",`url(#${K})`)}),le.length===0&&Array.from(W.children).forEach(g=>{g.nodeName!=="defs"&&g.nodeName!=="style"&&g.setAttribute("fill",`url(#${K})`)}),W.children.length>0?Array.from(W.children).forEach(g=>{j.appendChild(g)}):j.innerHTML=W.innerHTML,V.appendChild(j),a.appendChild(V)}}catch(N){console.warn("Failed to process textured element:",N)}}}}}return d.appendChild(a),{svg:d,width:m,height:w}}async function me(){console.log("Starting SVG export...");const e=window.getPreviewMode?window.getPreviewMode():!1;window.setPreviewMode&&!e&&(window.setPreviewMode(!0),document.body.classList.add("preview-mode"),await new Promise(t=>setTimeout(t,100)));try{const{svg:t}=await te(),n=new XMLSerializer().serializeToString(t),c=new Blob([n],{type:"image/svg+xml"}),i=URL.createObjectURL(c),o=document.createElement("a");o.href=i,o.download=`asemia-composition-${Date.now()}.svg`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i),console.log("SVG export complete!")}catch(t){console.error("SVG export failed:",t),alert("Export failed: "+t.message)}finally{window.setPreviewMode&&!e&&(window.setPreviewMode(!1),document.body.classList.remove("preview-mode"))}}async function pe(){console.log("Starting PNG export...");const e=window.getPreviewMode?window.getPreviewMode():!1;window.setPreviewMode&&!e&&(window.setPreviewMode(!0),document.body.classList.add("preview-mode"),await new Promise(t=>setTimeout(t,100)));try{const{svg:t,width:s,height:n}=await te(),i=new XMLSerializer().serializeToString(t),o=new Blob([i],{type:"image/svg+xml;charset=utf-8"}),l=URL.createObjectURL(o),m=new Image;await new Promise((b,f)=>{m.onload=b,m.onerror=f,m.src=l});const w=document.createElement("canvas"),r=2;w.width=s*r,w.height=n*r;const d=w.getContext("2d");d.scale(r,r),d.drawImage(m,0,0,s,n),URL.revokeObjectURL(l);const a=await new Promise(b=>{w.toBlob(b,"image/png")}),P=URL.createObjectURL(a),S=document.createElement("a");S.href=P,S.download=`asemia-composition-${Date.now()}.png`,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(P),console.log("PNG export complete!")}catch(t){console.error("PNG export failed:",t),alert("Export failed: "+t.message)}finally{window.setPreviewMode&&!e&&(window.setPreviewMode(!1),document.body.classList.remove("preview-mode"))}}async function he(){console.log("Starting JPEG export...");const e=window.getPreviewMode?window.getPreviewMode():!1;window.setPreviewMode&&!e&&(window.setPreviewMode(!0),document.body.classList.add("preview-mode"),await new Promise(t=>setTimeout(t,100)));try{const t=document.documentElement.classList.contains("dark"),s=window.getComputedStyle(document.body),n=t?"#0f172a":"#ffffff",c=t?"#ffffff":"#000000";console.log("Theme:",t?"dark":"light"),console.log("Background color:",n),console.log("Fill color:",c);const{svg:i,width:o,height:l}=await te(),m=i.cloneNode(!0);m.querySelectorAll("path, polygon, circle, ellipse, rect, line, polyline").forEach(p=>{const C=p.getAttribute("fill"),h=p.getAttribute("stroke");(!C||C!=="none"&&!C.startsWith("url(#"))&&p.setAttribute("fill",c),h&&h!=="none"&&!h.startsWith("url(#")&&p.setAttribute("stroke",c)});const d=new XMLSerializer().serializeToString(m),a=new Blob([d],{type:"image/svg+xml;charset=utf-8"}),P=URL.createObjectURL(a),S=new Image;await new Promise((p,C)=>{S.onload=p,S.onerror=C,S.src=P});const b=document.createElement("canvas"),f=2;b.width=o*f,b.height=l*f;const I=b.getContext("2d");I.scale(f,f),I.fillStyle=n,I.fillRect(0,0,o,l),I.drawImage(S,0,0,o,l),URL.revokeObjectURL(P);const Z=await new Promise(p=>{b.toBlob(p,"image/jpeg",.95)}),E=URL.createObjectURL(Z),v=document.createElement("a");v.href=E,v.download=`asemia-composition-${Date.now()}.jpg`,document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL(E),console.log("JPEG export complete!")}catch(t){console.error("JPEG export failed:",t),alert("Export failed: "+t.message)}finally{window.setPreviewMode&&!e&&(window.setPreviewMode(!1),document.body.classList.remove("preview-mode"))}}document.addEventListener("DOMContentLoaded",()=>{window.exportAsPNG=pe,window.exportAsSVG=me,window.exportAsJPEG=he,console.log("Export functionality initialized")});const fe=[{id:"welcome",title:"Welcome to the Asemic Typeform Crafter!",generalContent:`Build unique typographic forms using the fundamental elements of type: Serifs, Bodies, and Joins.

Let's take a quick tour.`,desktopContent:"",mobileContent:"",desktopTargetSelector:null,mobileTargetSelector:"",position:"center",showSkip:!0,highlightPulse:!1},{id:"grids",title:"Understanding the Grids",generalContent:`You work with two overlapping grids:

• 5×5 Serifs Grid (white cells)
• 4×4 Joins Grid (inset, connecting elements)

Click anywhere in the grid to place shapes.`,desktopContent:"",mobileContent:"",desktopTargetSelector:".builder-grids-wrapper",mobileTargetSelector:"",position:"bottom",highlightPulse:!0,showSkip:!0},{id:"mobile-tabs",title:"Selecting Shapes",generalContent:`Tap a tab to view available shapes in that category.

Then tap a shape to select it.`,desktopContent:"",mobileContent:"",desktopTargetSelector:"#mobileSerifTab",mobileTargetSelector:"",position:"bottom",highlightPulse:!0,showSkip:!0,mobileOnly:!0},{id:"desktop-sidebar",title:"Selecting Shapes",generalContent:"",desktopContent:`Choose from Bodies/Serifs or Joins in the sidebar.

Click a shape to select it.

Your selected shape becomes highlighted.`,mobileContent:`Choose from Bodies/Serifs or Joins in the topbar.
Tap a shape to select it.

Your selected shape becomes highlighted.`,desktopTargetSelector:"#sidebar",mobileTargetSelector:"",position:"right",highlightPulse:!0,showSkip:!0,desktopOnly:!0},{id:"placing-shapes",title:"Placing Shapes",generalContent:"",desktopContent:`Click any grid cell to place your selected shape.

• Serifs/Bodies go in the 5×5 grid
• Joins go in the 4×4 grid.`,mobileContent:`Tap any grid cell to place your selected shape.

• Serifs/Bodies go in the 5×5 grid
• Joins go in the 4×4 grid.`,desktopTargetSelector:".builder-grids-wrapper",mobileTargetSelector:"",position:"bottom",highlightPulse:!0,showSkip:!0},{id:"erase-mode",title:"Erase Mode",generalContent:"Toggle Erase Mode to quickly remove shapes.",desktopContent:"Click the Erase button, then click any shape to remove it.",mobileContent:"Tap the Erase button, then tap any shape to target it for deletion. Tap again to confirm the removal.",desktopTargetSelector:"#desktopEraseBtn",mobileTargetSelector:"#mobileEraseBtn",position:"bottom",mobilePosition:"top",highlightPulse:!0,showSkip:!0},{id:"preview-mode",title:"Preview Mode",generalContent:`Hide grid lines to see your form without distractions.

Toggle Preview Mode to view your composition cleanly.`,desktopContent:"",mobileContent:"",desktopTargetSelector:"#desktopPreviewBtn",mobileTargetSelector:"#mobilePreviewBtn",position:"bottom",mobilePosition:"top",highlightPulse:!0,showSkip:!0},{id:"saving",title:"Saving & Loading",generalContent:`Save your work to browser storage or download as JSON.

Use the Save menu to manage your compositions.`,desktopContent:"",mobileContent:"",desktopTargetSelector:null,mobileTargetSelector:"#mobileSettingsBtn",position:"center",mobilePosition:"top",highlightPulse:!0,showSkip:!0},{id:"size",title:"Adjusting Size",generalContent:`Change the grid size to view your form at different scales.

Experiment with different sizes to see how your composition looks.`,desktopContent:"",mobileContent:"",desktopTargetSelector:null,mobileTargetSelector:"#mobileSizeBtn",position:"center",mobilePosition:"top",highlightPulse:!0,showSkip:!0},{id:"complete",title:"You're Ready to Create!",generalContent:`Start building your asemic typeforms.

Experiment, explore, and have fun.

💡 Tip: Check out the Archive to see examples, or try the Word and Sentence Generators for inspiration.`,desktopContent:"",mobileContent:"",desktopTargetSelector:null,mobileTargetSelector:"",position:"center",highlightPulse:!1,showSkip:!1}];let k=0,ee=window.innerWidth<768,q,O,Q,oe;window.nextTutorialStep=function(){console.log("Next button clicked, current step:",k),q();const e=O();if(k++,k>=e.length){oe();return}Q(e[k])};window.previousTutorialStep=function(){console.log("Back button clicked"),q(),k--;const e=O();k<0&&(k=0),Q(e[k])};window.skipTutorial=function(){console.log("Skip button clicked"),q(),oe()};window.resetTutorial=function(){console.log("Resetting tutorial state..."),localStorage.removeItem("hasSeenFreebuilderTutorial"),q();const e=document.getElementById("tutorialHelpBtn");e&&e.remove(),k=0,console.log("Tutorial reset complete. Reload the page to see the tutorial again.")};function we(){if(console.log("Initializing tutorial system..."),localStorage.getItem("hasSeenFreebuilderTutorial")){console.log("User has seen tutorial, adding help button"),ce();return}setTimeout(()=>{console.log("Starting tutorial for first-time user"),ae()},1500)}function ae(){k=0,ee=window.innerWidth<768;const e=O();e.length>0&&Q(e[0])}O=function(){return fe.filter(e=>!(e.mobileOnly&&!ee||e.desktopOnly&&ee))};Q=function(e){console.log("Showing tutorial step:",e.id);const t=window.innerWidth<768,s=t?e.mobileTargetSelector||e.desktopTargetSelector:e.desktopTargetSelector||e.mobileTargetSelector,n=t&&e.mobilePosition?e.mobilePosition:e.position,c=be();document.body.appendChild(c),s&&(Se(s,e.highlightPulse)||console.warn("Target element not found:",s));const i=ve(e);document.body.appendChild(i),requestAnimationFrame(()=>{ye(i,s,n,e.id)}),requestAnimationFrame(()=>{c.style.opacity="1",i.style.opacity="1"})};function be(){const e=document.createElement("div");return e.id="tutorial-overlay",e.className="fixed inset-0 bg-black/30 z-[9998] transition-opacity duration-300",e.style.opacity="0",e.addEventListener("click",t=>{if(t.target===e){const n=O()[k];n&&n.showSkip&&skipTutorial()}}),e}function ve(e){const t=document.createElement("div");t.id="tutorial-tooltip",t.className="fixed z-[9999] bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-4 md:p-6 max-w-sm md:max-w-md transition-opacity duration-300",t.style.opacity="0";const s=O(),n=s.findIndex(l=>l.id===e.id),c=s.length,i=window.innerWidth<768;let o=e.generalContent||"";if(i&&e.mobileContent?o=e.mobileContent:!i&&e.desktopContent&&(o=e.desktopContent),e.generalContent&&(i&&e.mobileContent||!i&&e.desktopContent)){const l=i?e.mobileContent:e.desktopContent;o=e.generalContent+(l?`

`+l:"")}return t.innerHTML=`
    <div class="space-y-3 md:space-y-4">
      <div class="flex items-start justify-between">
        <h3 class="text-lg md:text-xl font-serif font-bold text-gray-900 dark:text-gray-100 pr-8 leading-tight">
          ${e.title}
        </h3>
        ${e.showSkip?`
          <button onclick="window.skipTutorial()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors text-sm font-medium">
            Skip
          </button>
        `:""}
      </div>

      <p class="text-sm md:text-base text-gray-600 dark:text-gray-300 leading-relaxed whitespace-pre-line">
        ${o}
      </p>

      <div class="flex items-center justify-between pt-3 md:pt-4">
        <div class="text-xs md:text-sm text-gray-500">
          Step ${n+1} of ${c}
        </div>

        <div class="flex gap-2">
          ${n>0?`
            <button onclick="window.previousTutorialStep()"
              class="px-3 md:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors text-sm font-medium text-gray-700 dark:text-gray-200">
              Back
            </button>
          `:""}

          <button onclick="window.nextTutorialStep()"
            class="px-4 md:px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium">
            ${n===c-1?"Finish":"Next"}
          </button>
        </div>
      </div>
    </div>
  `,t}function Se(e,t=!1){const s=document.querySelector(e);if(!s)return!1;const n=s.getBoundingClientRect(),c=document.createElement("div");return c.id="tutorial-spotlight",c.className=`fixed z-[9998] border-4 border-blue-500 rounded-lg pointer-events-none transition-all duration-300 ${t?"animate-pulse":""}`,c.style.cssText=`
    top: ${n.top-8}px;
    left: ${n.left-8}px;
    width: ${n.width+16}px;
    height: ${n.height+16}px;
    box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.4);
  `,document.body.appendChild(c),!0}function ye(e,t,s,n=null){if(!t||s==="center"){e.style.cssText+=`
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    `;return}const c=document.querySelector(t);if(!c){e.style.cssText+=`
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    `;return}const i=c.getBoundingClientRect(),o=e.getBoundingClientRect(),l=16,m=window.innerWidth,w=window.innerHeight;let r,d,a="";switch(s){case"bottom":r=i.bottom+l,d=i.left+i.width/2,a="translateX(-50%)",r+o.height>w&&(r=i.top-o.height-l);break;case"top":r=i.top-o.height-l,d=i.left+i.width/2,a="translateX(-50%)",r<0&&(r=i.bottom+l);break;case"right":r=i.top+i.height/2,d=i.right+l,a="translateY(-50%)",d+o.width>m&&(d=i.left-o.width-l);break;case"left":r=i.top+i.height/2,d=i.left-o.width-l,a="translateY(-50%)",d<0&&(d=i.right+l);break;default:r=w/2,d=m/2,a="translate(-50%, -50%)"}n==="erase-mode"&&(r-=80),n==="preview-mode"&&(r-=80);const S=window.innerWidth<768&&(n==="saving"||n==="size");let b=d,f=r;a.includes("translateX(-50%)")&&(b=d-o.width/2),a.includes("translateY(-50%)")&&(f=r-o.height/2),a==="translate(-50%, -50%)"&&(b=d-o.width/2,f=r-o.height/2),b<l&&(d=l,a.includes("translateX(-50%)")&&(d=l+o.width/2),a=a.replace("translateX(-50%)","")),b+o.width>m-l&&(d=m-o.width-l,a.includes("translateX(-50%)")&&(d=m-o.width/2-l),a=a.replace("translateX(-50%)","")),f<l&&(r=l,a.includes("translateY(-50%)")&&(r=l+o.height/2),a=a.replace("translateY(-50%)","")),f+o.height>w-l&&(r=w-o.height-l,a.includes("translateY(-50%)")&&(r=w-o.height/2-l),a=a.replace("translateY(-50%)","")),a=a.trim(),S?e.style.cssText+=`
      top: ${r}px;
      right: 30px;
      margin-left: 100px;
      left: auto;
      ${a?`transform: ${a};`:""}
    `:e.style.cssText+=`
      top: ${r}px;
      left: ${d}px;
      ${a?`transform: ${a};`:""}
    `}q=function(){const e=document.getElementById("tutorial-overlay"),t=document.getElementById("tutorial-tooltip"),s=document.getElementById("tutorial-spotlight");e&&(e.style.opacity="0",setTimeout(()=>e.remove(),300)),t&&(t.style.opacity="0",setTimeout(()=>t.remove(),300)),s&&s.remove()};oe=function(){localStorage.setItem("hasSeenFreebuilderTutorial","true"),console.log("Tutorial completed"),ce()};function ce(){if(document.getElementById("tutorialHelpBtn"))return;const e=document.querySelector("nav");if(!e){console.warn("Nav element not found, cannot add help button");return}const t=e.querySelector(".flex.items-center.space-x-4:last-child");if(!t){console.warn("Right section not found, cannot add help button");return}const s=document.createElement("button");s.id="tutorialHelpBtn",s.className="px-3 md:px-4 py-1.5 md:py-2 hover:underline text-black dark:text-white rounded-lg transition-colors text-sm md:text-base font-medium shadow-md",s.textContent="Help",s.addEventListener("click",()=>{console.log("Help button clicked, restarting tutorial"),ae()}),t.appendChild(s),console.log("Help button added to navigation")}ge();setTimeout(()=>{we()},1e3);
